<!DOCTYPE HTML>
<html lang="zh-CN">


<head>
    <meta charset="utf-8">
    <meta name="keywords" content="Redis笔记, SYH的博客">
    <meta name="description" content="">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="renderer" content="webkit|ie-stand|ie-comp">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <!-- Global site tag (gtag.js) - Google Analytics -->


    <title>Redis笔记 | SYH的博客</title>
    <link rel="icon" type="image/png" href="/favicon.png">

    <link rel="stylesheet" type="text/css" href="/libs/awesome/css/all.css">
    <link rel="stylesheet" type="text/css" href="/libs/materialize/materialize.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/aos/aos.css">
    <link rel="stylesheet" type="text/css" href="/libs/animate/animate.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/lightGallery/css/lightgallery.min.css">
    <link rel="stylesheet" type="text/css" href="/css/matery.css">
    <link rel="stylesheet" type="text/css" href="/css/my.css">

    <script src="/libs/jquery/jquery.min.js"></script>

<meta name="generator" content="Hexo 4.1.1"><link rel="stylesheet" href="/css/prism.css" type="text/css">
<link rel="stylesheet" href="/css/prism-line-numbers.css" type="text/css"></head>


<body>
    <header class="navbar-fixed">
    <nav id="headNav" class="bg-color nav-transparent">
        <div id="navContainer" class="nav-wrapper container">
            <div class="brand-logo">
                <a href="/" class="waves-effect waves-light">
                    
                    <img src="/medias/logo.png" class="logo-img" alt="LOGO">
                    
                    <span class="logo-span">SYH的博客</span>
                </a>
            </div>
            

<a href="#" data-target="mobile-nav" class="sidenav-trigger button-collapse"><i class="fas fa-bars"></i></a>
<ul class="right nav-menu">
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/" class="waves-effect waves-light">
      
      <i class="fas fa-home" style="zoom: 0.6;"></i>
      
      <span>首页</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/tags" class="waves-effect waves-light">
      
      <i class="fas fa-tags" style="zoom: 0.6;"></i>
      
      <span>标签</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/categories" class="waves-effect waves-light">
      
      <i class="fas fa-bookmark" style="zoom: 0.6;"></i>
      
      <span>分类</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/archives" class="waves-effect waves-light">
      
      <i class="fas fa-archive" style="zoom: 0.6;"></i>
      
      <span>归档</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/about" class="waves-effect waves-light">
      
      <i class="fas fa-user-circle" style="zoom: 0.6;"></i>
      
      <span>关于</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/contact" class="waves-effect waves-light">
      
      <i class="fas fa-comments" style="zoom: 0.6;"></i>
      
      <span>留言板</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/friends" class="waves-effect waves-light">
      
      <i class="fas fa-address-book" style="zoom: 0.6;"></i>
      
      <span>友情链接</span>
    </a>
    
  </li>
  
  <li>
    <a href="#searchModal" class="modal-trigger waves-effect waves-light">
      <i id="searchIcon" class="fas fa-search" title="搜索" style="zoom: 0.85;"></i>
    </a>
  </li>
</ul>


<div id="mobile-nav" class="side-nav sidenav">

    <div class="mobile-head bg-color">
        
        <img src="/medias/logo.png" class="logo-img circle responsive-img">
        
        <div class="logo-name">SYH的博客</div>
        <div class="logo-desc">
            
            Never really desperate, only the lost of the soul.
            
        </div>
    </div>

    

    <ul class="menu-list mobile-menu-list">
        
        <li class="m-nav-item">
	  
		<a href="/" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-home"></i>
			
			首页
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/tags" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-tags"></i>
			
			标签
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/categories" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-bookmark"></i>
			
			分类
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/archives" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-archive"></i>
			
			归档
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/about" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-user-circle"></i>
			
			关于
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/contact" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-comments"></i>
			
			留言板
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/friends" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-address-book"></i>
			
			友情链接
		</a>
          
        </li>
        
        
        <li><div class="divider"></div></li>
        <li>
            <a href="https://github.com/blinkfox/hexo-theme-matery" class="waves-effect waves-light" target="_blank">
                <i class="fab fa-github-square fa-fw"></i>Fork Me
            </a>
        </li>
        
    </ul>
</div>


        </div>

        
            <style>
    .nav-transparent .github-corner {
        display: none !important;
    }

    .github-corner {
        position: absolute;
        z-index: 10;
        top: 0;
        right: 0;
        border: 0;
        transform: scale(1.1);
    }

    .github-corner svg {
        color: #0f9d58;
        fill: #fff;
        height: 64px;
        width: 64px;
    }

    .github-corner:hover .octo-arm {
        animation: a 0.56s ease-in-out;
    }

    .github-corner .octo-arm {
        animation: none;
    }

    @keyframes a {
        0%,
        to {
            transform: rotate(0);
        }
        20%,
        60% {
            transform: rotate(-25deg);
        }
        40%,
        80% {
            transform: rotate(10deg);
        }
    }
</style>

<a href="https://github.com/blinkfox/hexo-theme-matery" class="github-corner tooltipped hide-on-med-and-down" target="_blank"
   data-tooltip="Fork Me" data-position="left" data-delay="50">
    <svg viewBox="0 0 250 250" aria-hidden="true">
        <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path>
        <path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2"
              fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path>
        <path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z"
              fill="currentColor" class="octo-body"></path>
    </svg>
</a>
        
    </nav>

</header>

    



<div class="bg-cover pd-header post-cover" style="background-image: url('/medias/featureimages/17.jpg')">
    <div class="container" style="right: 0px;left: 0px;">
        <div class="row">
            <div class="col s12 m12 l12">
                <div class="brand">
                    <h1 class="description center-align post-title">Redis笔记</h1>
                </div>
            </div>
        </div>
    </div>
</div>




<main class="post-container content">

    
    <link rel="stylesheet" href="/libs/tocbot/tocbot.css">
<style>
    #articleContent h1::before,
    #articleContent h2::before,
    #articleContent h3::before,
    #articleContent h4::before,
    #articleContent h5::before,
    #articleContent h6::before {
        display: block;
        content: " ";
        height: 100px;
        margin-top: -100px;
        visibility: hidden;
    }

    #articleContent :focus {
        outline: none;
    }

    .toc-fixed {
        position: fixed;
        top: 64px;
    }

    .toc-widget {
        width: 345px;
        padding-left: 20px;
    }

    .toc-widget .toc-title {
        margin: 35px 0 15px 0;
        padding-left: 17px;
        font-size: 1.5rem;
        font-weight: bold;
        line-height: 1.5rem;
    }

    .toc-widget ol {
        padding: 0;
        list-style: none;
    }

    #toc-content {
        height: calc(100vh - 250px);
        overflow: auto;
    }

    #toc-content ol {
        padding-left: 10px;
    }

    #toc-content ol li {
        padding-left: 10px;
    }

    #toc-content .toc-link:hover {
        color: #42b983;
        font-weight: 700;
        text-decoration: underline;
    }

    #toc-content .toc-link::before {
        background-color: transparent;
        max-height: 25px;

        position: absolute;
        right: 23.5vw;
        display: block;
    }

    #toc-content .is-active-link {
        color: #42b983;
    }

    #floating-toc-btn {
        position: fixed;
        right: 15px;
        bottom: 76px;
        padding-top: 15px;
        margin-bottom: 0;
        z-index: 998;
    }

    #floating-toc-btn .btn-floating {
        width: 48px;
        height: 48px;
    }

    #floating-toc-btn .btn-floating i {
        line-height: 48px;
        font-size: 1.4rem;
    }
</style>
<div class="row">
    <div id="main-content" class="col s12 m12 l9">
        <!-- 文章内容详情 -->
<div id="artDetail">
    <div class="card">
        <div class="card-content article-info">
            <div class="row tag-cate">
                <div class="col s7">
                    
                    <div class="article-tag">
                        
                            <a href="/tags/database/">
                                <span class="chip bg-color">database</span>
                            </a>
                        
                            <a href="/tags/linux/">
                                <span class="chip bg-color">linux</span>
                            </a>
                        
                            <a href="/tags/Redis/">
                                <span class="chip bg-color">Redis</span>
                            </a>
                        
                    </div>
                    
                </div>
                <div class="col s5 right-align">
                    
                </div>
            </div>

            <div class="post-info">
                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-minus fa-fw"></i>发布日期:&nbsp;&nbsp;
                    2020-07-28
                </div>
                

                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-check fa-fw"></i>更新日期:&nbsp;&nbsp;
                    2020-08-01
                </div>
                

                
                <div class="info-break-policy">
                    <i class="far fa-file-word fa-fw"></i>文章字数:&nbsp;&nbsp;
                    10.9k
                </div>
                

                
                <div class="info-break-policy">
                    <i class="far fa-clock fa-fw"></i>阅读时长:&nbsp;&nbsp;
                    48 分
                </div>
                

                
                    <div id="busuanzi_container_page_pv" class="info-break-policy">
                        <i class="far fa-eye fa-fw"></i>阅读次数:&nbsp;&nbsp;
                        <span id="busuanzi_value_page_pv"></span>
                    </div>
				
            </div>
        </div>
        <hr class="clearfix">
        <div class="card-content article-card-content">
            <div id="articleContent">
                <h1 id="Redis"><a href="#Redis" class="headerlink" title="Redis"></a>Redis</h1><p>学习方式：不是为了面试和工作学习！仅仅是为了兴趣！兴趣才是最好的老师！</p>
<ul>
<li>基本的理论先学习，然后将知识融汇贯通！</li>
</ul>
<h2 id="Redis课程安排："><a href="#Redis课程安排：" class="headerlink" title="Redis课程安排："></a>Redis课程安排：</h2><ul>
<li>nosql讲解</li>
<li>阿里巴巴架构演</li>
<li>nosql数据模型</li>
<li>Nosql 四大分类 </li>
<li>CAP</li>
<li>BASE</li>
<li>Redis入门</li>
<li>Redis安装（Window &amp; Linux服务器）</li>
<li>五大基本数据类型<ul>
<li>String </li>
<li>List </li>
<li>Set </li>
<li>Hash </li>
<li>Zset</li>
</ul>
</li>
<li>三种特殊数据类型<ul>
<li>geo </li>
<li>hyperloglog </li>
<li>bitmap</li>
</ul>
</li>
<li>Redis 配置详解</li>
<li>Redis 持久化<ul>
<li>RDB</li>
<li>AOF</li>
</ul>
</li>
<li>Redis 事务操作</li>
<li>Redis 实现订阅发布</li>
<li>Redis 主从复制</li>
<li>Redis 哨兵模式（现在公司中所有的集群都用哨兵模式</li>
<li>缓存穿透及解决方案 缓存击穿及解决方案缓存雪崩及解决方案</li>
<li>基础API 之 Jedis 详解</li>
<li>SpringBoot 集成 Redis 操作</li>
</ul>
<h1 id="Nosql概述"><a href="#Nosql概述" class="headerlink" title="Nosql概述"></a>Nosql概述</h1><h2 id="为什么要用Nosql"><a href="#为什么要用Nosql" class="headerlink" title="为什么要用Nosql"></a>为什么要用Nosql</h2><blockquote>
<p>1、单机MySQL的年代！</p>
</blockquote>
<p><img src="/2020/07/28/redis/%E5%8D%95%E5%87%BBmysql.png" alt="单机MySQL"></p>
<p>90年代，一个基本的网站访问量一般不会太大，单个数据库完全足够！</p>
<p> 那个时候，更多的去使用静态网页 Html ~ 服务器根本没有太大的压力！</p>
<p> 思考一下，这种情况下：整个网站的瓶颈是什么？</p>
<p>1、数据量如果太大、一个机器放不下了！</p>
<p>2、数据的索引 （B+ Tree），一个机器内存也放不下 </p>
<p>3、访问量（读写混合），一个服务器承受不了~</p>
<p>只要你开始出现以上的三种情况之一，那么你就必须要晋级！</p>
<blockquote>
<p>2、Memcached（缓存） + MySQL + 垂直拆分 （读写分离）</p>
</blockquote>
<p>网站80%的情况都是在读，每次都要去查询数据库的话就十分的麻烦！</p>
<p>所以说我们希望减轻数据的压力，我们可以使用缓存来保证效率！ </p>
<p>发展过程： 优化数据结构和索引–&gt; 文件缓存（IO）—&gt; Memcached（当时最热门的技术！）</p>
<p><img src="/2020/07/28/redis/image-20200522235404449.png"></p>
<blockquote>
<p>3、分库分表 + 水平拆分 + MySQL集群</p>
</blockquote>
<p>早些年MyISAM： 表锁，十分影响效率！高并发下就会出现严重的锁问题 </p>
<p>转战Innodb：行锁</p>
<p>慢慢的就开始使用分库分表来解决写的压力！</p>
<p>MySQL在哪个年代推出了表分区！这个并没有多少公司 使用！</p>
<p>MySQL的集群，很好满足那个年代的所有需求！</p>
<p><img src="/2020/07/28/redis/image-20200522235404449.png"></p>
<blockquote>
<p>4、如今最近的年代</p>
</blockquote>
<p>2010–2020 十年之间，世界已经发生了翻天覆地的变化；（定位，也是一种数据，音乐，热榜！）</p>
<p>MySQL 等关系型数据库就不够用了！数据量很多，变化很快~！</p>
<p>MySQL 有的使用它来村粗一些比较大的文件，博客，图片！数据库表很大，效率就低了！如果有一种数据库来专门处理这种数据,</p>
<p>MySQL压力就变得十分小（研究如何处理这些问题！）大数据的IO压力下，表几乎没法更大</p>
<blockquote>
<p>目前一个基本的互联网项目！</p>
</blockquote>
<p><img src="/2020/07/28/redis/image-20200522235950435.png"></p>
<blockquote>
<p>为什么要用NoSQL！</p>
</blockquote>
<p>用户的个人信息，社交网络，地理位置。用户自己产生的数据，用户日志等等爆发式增长！</p>
<p>这时候我们就需要使用NoSQL数据库的，Nosql 可以很好的处理以上的情况！</p>
<h2 id="什么是NoSQL"><a href="#什么是NoSQL" class="headerlink" title="什么是NoSQL"></a>什么是NoSQL</h2><blockquote>
<p>NoSQL</p>
</blockquote>
<p>NoSQL = Not Only SQL （不仅仅是SQL）关系型数据库：表格 ，行 ，列</p>
<p>泛指非关系型数据库的，随着web2.0互联网的诞生！传统的关系型数据库很难对付web2.0时代！尤其是超大规模的高并发的社区！ 暴露出来很多难以克服的问题，NoSQL在当今大数据环境下发展的十分迅速，Redis是发展快的，而且是我们当下必须要掌握的一个技术！</p>
<p>很多的数据类型用户的个人信息，社交网络，地理位置。这些数据类型的存储不需要一个固定的格式！不需要多余的操作就可以横向扩展的 ！  Map&lt;String,Object&gt; 使用键值对来控制！</p>
<blockquote>
<p>NoSQL 特点</p>
</blockquote>
<p>解耦！</p>
<p>1、  方便扩展（数据之间没有关系，很好扩展！）</p>
<p>2、  大数据量高性能（Redis 一秒写8万次，读取11万，NoSQL的缓存记录级，是一种细粒度的缓存，性能会比较高！）</p>
<p>3、  数据类型是多样型的！（不需要事先设计数据库！随取随用！如果是数据量十分大的表，很多人就无法设计了！）</p>
<p>4、  传统 RDBMS 和 NoSQL</p>
<pre class="line-numbers language-txt"><code class="language-txt">传统的 RDBMS
- 结构化组织
- SQL
- 数据和关系都存在单独的表中 row col
- 操作操作，数据定义语言
- 严格的一致性
- 基础的事务
- .....<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-txt"><code class="language-txt">Nosql
- 不仅仅是数据
- 没有固定的查询语言
- 键值对存储，列存储，文档存储，图形数据库（社交关系）
- 最终一致性，
- CAP定理和BASE （异地多活） 初级架构师！
- 高性能，高可用，高可扩
- ....<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p>了解：3V+3高</p>
</blockquote>
<p>大数据时代的3V：主要是描述问题的</p>
<ol>
<li>海量Volume</li>
<li>多样Variety</li>
<li>实时Velocity</li>
</ol>
<p>大数据时代的3高：主要是对程序的要求</p>
<ol>
<li>高并发</li>
<li>高可扩</li>
<li>高性能</li>
</ol>
<p>真正在公司中的实践：NoSQL + RDBMS 一起使用才是最强的，阿里巴巴的架构演进！ </p>
<p>技术没有高低之分，就看你如何去使用！（提升内功，思维的提高！）</p>
<h2 id="阿里巴巴演进分析"><a href="#阿里巴巴演进分析" class="headerlink" title="阿里巴巴演进分析"></a>阿里巴巴演进分析</h2><p>思考问题：这么多东西难道都是在一个数据库中的吗?</p>
<p><img src="/2020/07/28/redis/image-20200523121415218.png"></p>
<p>技术急不得，越是慢慢学，才能越扎实！<br>开源才是技术的王道！<br>任何一家互联网的公司，都不可能只是简简单单让用户能用就好了！<br>大量公司做的都是相同的业务；（竞品协议）<br>随着这样的竞争，业务是越来越完善，然后对于开发者的要求也是越来越高！</p>
<p><img src="/2020/07/28/redis/image-20200523121552527.png"></p>
<p>如果你未来相当一个架构师： 没有什么是加一层解决不了的！</p>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># 1、商品的基本信息</span>
    名称、价格、商家信息；
    关系型数据库就可以解决了！ MySQL / Oracle （淘宝早年就去IOE了！- 王坚：推荐文章：阿里云
    的这群疯子：40分钟重要！）
    淘宝内部的 MySQL 不是大家用的 MySQL

<span class="token comment" spellcheck="true"># 2、商品的描述、评论（文字比较多）</span>
    文档型数据库中，MongoDB

<span class="token comment" spellcheck="true"># 3、图片</span>
    分布式文件系统 FastDFS
    - 淘宝自己的 TFS
    - Gooale的 GFS
    - Hadoop HDFS
    - 阿里云的 oss

<span class="token comment" spellcheck="true"># 4、商品的关键字 （搜索）</span>
    - 搜索引擎 solr elasticsearch
    - ISerach：多隆（多去了解一下这些技术大佬！）
    所有牛逼的人都有一段苦逼的岁月！但是你只要像SB一样的去坚持，终将牛逼！

<span class="token comment" spellcheck="true"># 5、商品热门的波段信息</span>
    - 内存数据库
    - Redis Tair、Memache<span class="token punctuation">..</span>.

<span class="token comment" spellcheck="true"># 6、商品的交易，外部的支付接口</span>
    - 三方应用<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>要知道，一个简单地网页背后的技术一定不是大家所想的那么简单！</p>
<p>大型互联网应用问题：</p>
<ul>
<li>数据类型太多了！</li>
<li>数据源繁多，经常重构！</li>
<li>数据要改造，大面积改造？</li>
</ul>
<p>解决问题：</p>
<p><img src="/2020/07/28/redis/image-20200523123820576.png"></p>
<p><img src="/2020/07/28/redis/image-20200523125920602.png"></p>
<p>这里以上都是NoSQL入门概述，不仅能够提高大家的知识，还可以帮助大家了解大厂的工作内容</p>
<h2 id="Nosql四大分类"><a href="#Nosql四大分类" class="headerlink" title="Nosql四大分类"></a>Nosql四大分类</h2><p><strong>KV键值对：</strong></p>
<ul>
<li>新浪：Redis</li>
<li>美团：Redis + Tair</li>
<li>阿里、百度：Redis + MemCache</li>
</ul>
<p><strong>文档型数据库（bson格式 和json一样）：</strong></p>
<ul>
<li>MongoDB （一般必须要掌握）<ul>
<li>MongoDB 是一个基于分布式文件存储的数据库，C++ 编写，主要用来处理大量的文档！</li>
<li>MongoDB 是一个介于关系型数据库和非关系型数据中中间的产品！MongoDB 是非关系型数据库中功能最丰富，最像关系型数据库的！</li>
</ul>
</li>
<li>ConthDB</li>
</ul>
<p><strong>列存储数据库</strong></p>
<ul>
<li>HBase</li>
<li>分布式文件系统</li>
</ul>
<p><strong>图关系数据库</strong></p>
<ul>
<li>他不是存图形，放的是关系，比如：朋友圈社交网络，广告推荐！</li>
<li>Neo4j，InfoGrid；</li>
</ul>
<blockquote>
<p>四者对比！</p>
</blockquote>
<table>
<thead>
<tr>
<th align="center"><strong>分类</strong></th>
<th align="center"><strong>Examples举例</strong></th>
<th align="center">典型应用场景</th>
<th align="center">数据模型</th>
<th align="center">优点</th>
<th align="center">缺点</th>
</tr>
</thead>
<tbody><tr>
<td align="center"><strong>键值（key-value）[3]</strong></td>
<td align="center">Tokyo Cabinet/Tyrant, Redis, Voldemort, Oracle BDB</td>
<td align="center">内容缓存，主要用于处理大量数据的高访问负载，也用于一些日志系统等等。[3]</td>
<td align="center">Key 指向 Value 的键值对，通常用hash table来实现[3]</td>
<td align="center">查找速度快</td>
<td align="center">数据无结构化，通常只被当作字符串或者二进制数据[3]</td>
</tr>
<tr>
<td align="center"><strong>列存储数据库[3]</strong></td>
<td align="center">Cassandra, HBase, Riak</td>
<td align="center">分布式的文件系统</td>
<td align="center">以列簇式存储，将同一列数据存在一起</td>
<td align="center">查找速度快，可扩展性强，更容易进行分布式扩展</td>
<td align="center">功能相对局限</td>
</tr>
<tr>
<td align="center"><strong>文档型数据库[3]</strong></td>
<td align="center">CouchDB, MongoDb</td>
<td align="center">Web应用（与Key-Value类似，Value是结构化的，不同的是数据库能够了解Value的内容）</td>
<td align="center">Key-Value对应的键值对，Value为结构化数据</td>
<td align="center">数据结构要求不严格，表结构可变，不需要像关系型数据库一样需要预先定义表结构</td>
<td align="center">查询性能不高，而且缺乏统一的查询语法。</td>
</tr>
<tr>
<td align="center"><strong>图形(Graph)数据库[3]</strong></td>
<td align="center">Neo4J, InfoGrid, Infinite Graph</td>
<td align="center">社交网络，推荐系统等。专注于构建关系图谱</td>
<td align="center">图结构</td>
<td align="center">利用图结构相关算法。比如最短路径寻址，N度关系查找等</td>
<td align="center">很多时候需要对整个图做计算才能得出需要的信息，而且这种结构不太好做分布式的集群方案。[3]</td>
</tr>
</tbody></table>
<p>敬畏之心可以使人进步！宇宙！科幻！ 活着的意义？ 追求幸福（帮助他人，感恩之心），探索未知（努力的学习，不要这个社会抛弃）</p>
<h1 id="redis入门"><a href="#redis入门" class="headerlink" title="redis入门"></a>redis入门</h1><h2 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h2><blockquote>
<p>Redis是什么？</p>
</blockquote>
<p>Redis（==R==emote ==D==ictionary ==S==erver )，即远程字典服务 ! 是一个开源的使用ANSI C语言编写、支持网络、可基于内存亦可持久化的日志型、Key-Value数据库， 并提供多种语言的API。</p>
<p>redis会周期性的把更新的数据写入磁盘或者把修改操作写入追加的记录文件，并且在此基础上实现了 master-slave(主从)同步。 </p>
<p>免费和开源！是当下最热门的 NoSQL 技术之一！也被人们称之为结构化数据库！</p>
<blockquote>
<p>Redis 能干嘛？</p>
</blockquote>
<p>1、内存存储、持久化，内存中是断电即失、所以说持久化很重要（rdb、aof）<br>2、效率高，可以用于高速缓存<br>3、发布订阅系统<br>4、地图信息分析<br>5、计时器、计数器（浏览量！）<br>6、……..</p>
<blockquote>
<p>Redis特性</p>
</blockquote>
<p>1、多样的数据类型<br>2、持久化<br>3、集群<br>4、事务</p>
<p>5、……</p>
<blockquote>
<p>学习中需要用到的东西</p>
</blockquote>
<p>官网：<a href="https://redis.io/" target="_blank" rel="noopener">https://redis.io/</a></p>
<p><img src="https://gitee.com/yuankeyuan/picture_bed/raw/master/redis/image-20200523143125934.png" alt="image-20200523143125934"></p>
<p>注意：window在 Github上下载（停更很久了！）</p>
<p><strong>Redis推荐都是在Linux服务器上搭建的，我们是基于Linux学习！</strong></p>
<h2 id="Linux安装"><a href="#Linux安装" class="headerlink" title="Linux安装"></a>Linux安装</h2><p>1、下载安装包 redis-5.0.5.tar.gz 到/opt下</p>
<p>2、解压Redis的安装包</p>
<p><img src="/2020/07/28/redis/image-20200523231746914.png"></p>
<p>3、进入解压后的文件，可以看到我们redis的配置文件</p>
<p><img src="/2020/07/28/redis/image-20200523231847950.png"></p>
<p>4、基本的环境安装</p>
<pre class="line-numbers language-shell"><code class="language-shell">yum install gcc-c++
make
make install<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p><img src="/2020/07/28/redis/image-20200523232344379.png"></p>
<p>没报错，说明安装成功！</p>
<p>5、redis的默认安装路径 <code>/usr/local/bin</code></p>
<p><img src="/2020/07/28/redis/image-20200523233248249.png"></p>
<p>6、将redis配置文件复制到/usr/local/bin/(为了方便)</p>
<p>之后就以这个配置文件的方式启动！</p>
<pre class="line-numbers language-shell"><code class="language-shell">cp /opt/redis-5.0.5/redis.conf /usr/local/bin/<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>7、redis默认不是后台启动的，修改配置文件！</p>
<p>如果有bind 127.0.0.1,直接#注释掉</p>
<p><img src="/2020/07/28/redis/image-20200523235142532.png"></p>
<p>8、启动Redis服务！</p>
<p><img src="/2020/07/28/redis/image-20200523235938744.png"></p>
<p>9、使用redis-cli 进行连接测试！</p>
<p><img src="/2020/07/28/redis/image-20200524000213465.png"></p>
<p>10、查看redis的进程是否开启！</p>
<p><img src="/2020/07/28/redis/image-20200524000308165.png"></p>
<p>11、如何关闭Redis服务呢？ shutdown</p>
<p><img src="/2020/07/28/redis/image-20200524000614886.png"></p>
<p>13、后面我们会使用单机多Redis启动集群测试！</p>
<h2 id="测试性能"><a href="#测试性能" class="headerlink" title="测试性能"></a>测试性能</h2><p>redis-benchmark 是一个压力测试工具！<br>官方自带的性能测试工具！<br>redis-benchmark 命令参数！<br>图片来自菜鸟教程</p>
<p><img src="https://gitee.com/yuankeyuan/picture_bed/raw/master/redis/image-20200524001521613.png"></p>
<p>我们来简单测试下：</p>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># 测试：100个并发连接 100000请求</span>
redis-benchmark -h localhost -p 6379 -c 100 -n 100000<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>如何查看这些分析呢？</p>
<p><img src="/2020/07/28/redis/image-20200524002308671.png"></p>
<h2 id="基础知识"><a href="#基础知识" class="headerlink" title="基础知识"></a>基础知识</h2><p>redis很占内存，需要给linux最大限度地分配内存echo 1 &gt; /proc/sys/vm/overcommit_memory</p>
<p>redis默认有16个数据库</p>
<p>默认使用的是第0个</p>
<p>可以使用 select 进行切换数据库！</p>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@iZbp15ep5ykkm4d2s4409yZ bin<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># ./redis-cli -p 6379</span>
127.0.0.1:6379<span class="token operator">></span> <span class="token keyword">select</span> 1    <span class="token comment" spellcheck="true">#切换数据库</span>
OK
127.0.0.1:6379<span class="token punctuation">[</span>1<span class="token punctuation">]</span><span class="token operator">></span> DBSIZE     <span class="token comment" spellcheck="true">#查看DB大小</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> 0
127.0.0.1:6379<span class="token operator">></span> keys *
1<span class="token punctuation">)</span> <span class="token string">"mylist"</span>
2<span class="token punctuation">)</span> <span class="token string">"counter:__rand_int__"</span>
3<span class="token punctuation">)</span> <span class="token string">"k1"</span>
4<span class="token punctuation">)</span> <span class="token string">"key:__rand_int__"</span>
5<span class="token punctuation">)</span> <span class="token string">"myset:__rand_int__"</span>
127.0.0.1:6379<span class="token operator">></span> flushdb
OK
127.0.0.1:6379<span class="token operator">></span> keys *
<span class="token punctuation">(</span>empty list or set<span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># 清除当前数据库 flushdb</span>
<span class="token comment" spellcheck="true"># 清除全部数据库的内容 FLUSHALL</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><img src="/2020/07/28/redis/image-20200524004037851.png"></p>
<blockquote>
<p>Redis 是单线程的！</p>
</blockquote>
<p>明白Redis是很快的，官方表示，Redis是基于内存操作，CPU不是Redis性能瓶颈，Redis的瓶颈是根据 机器的内存和网络带宽</p>
<p>既然可以使用单线程来实现，就使用单线程了！所有就使用了单线程了！ </p>
<p>Redis 是C 语言写的，官方提供的数据为 100000+ 的QPS，完全不比同样是使用 key-vale的 Memecache差！</p>
<p><strong>Redis 为什么单线程还这么快？</strong></p>
<p>1、误区1：高性能的服务器一定是多线程的？</p>
<p>2、误区2：多线程（CPU上下文会切换！）一定比单线程效率高！</p>
<p> 先去CPU&gt;内存&gt;硬盘的速度要有所了解！</p>
<p>核心：redis 是将所有的数据全部放在内存中的，所以说使用单线程去操作效率就是最高的，多线程 （CPU上下文会切换：耗时的操作！！！），对于内存系统来说，如果没有上下文切换效率就是最高 的！多次读写都是在一个CPU上的，在内存情况下，这个就是最佳的方案！</p>
<h1 id="五大数据类型"><a href="#五大数据类型" class="headerlink" title="五大数据类型"></a>五大数据类型</h1><blockquote>
<p>查看官网文档</p>
</blockquote>
<p><img src="/2020/07/28/redis/image-20200524104558176.png"></p>
<p>翻译：</p>
<p>​    Redis 是一个开源（BSD许可）的，内存中的数据结构存储系统，它可以用作数据库、缓存和消息中间件。 它支持多种类型的数据结构，如 字符串（strings）， 散列（hashes）， 列表（lists）， 集合（sets）， 有序集合（sorted sets） 与范围查询， bitmaps， hyperloglogs 和 地理空间（geospatial） 索引半径查询。 Redis 内置了 复制（replication），LUA脚本（Lua scripting）， LRU驱动事件（LRU eviction），事务（transactions） 和不同级别的 磁盘持久化（persistence）， 并通过 Redis哨兵（Sentinel）和自动 分区（Cluster）提供高可用性（high availability）。</p>
<blockquote>
<p>我们现在讲解的所有命令大家一定要全部记住，后面我们使用SpringBoot。Jedis，所有的方法就是 这些命令！ 单点登录</p>
</blockquote>
<h2 id="Redis-Key"><a href="#Redis-Key" class="headerlink" title="Redis-Key"></a>Redis-Key</h2><pre class="line-numbers language-bash"><code class="language-bash">127.0.0.1:6379<span class="token operator">></span> keys *         <span class="token comment" spellcheck="true"># 查看所有的key</span>
<span class="token punctuation">(</span>empty list or set<span class="token punctuation">)</span>
127.0.0.1:6379<span class="token operator">></span> <span class="token keyword">set</span> name kuangshen <span class="token comment" spellcheck="true"># set key</span>
OK
127.0.0.1:6379<span class="token operator">></span> keys *
1<span class="token punctuation">)</span> <span class="token string">"name"</span>
127.0.0.1:6379<span class="token operator">></span> <span class="token keyword">set</span> age 1
OK
127.0.0.1:6379<span class="token operator">></span> keys *
1<span class="token punctuation">)</span> <span class="token string">"age"</span>
2<span class="token punctuation">)</span> <span class="token string">"name"</span>
127.0.0.1:6379<span class="token operator">></span> EXISTS name <span class="token comment" spellcheck="true"># 判断当前的key是否存在</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> 1
127.0.0.1:6379<span class="token operator">></span> EXISTS name1
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> 0
127.0.0.1:6379<span class="token operator">></span> move name 1 <span class="token comment" spellcheck="true"># 将当前的key移动到索引为db的数据库中，del key 命令是删除当前数据库key数据</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> 1
127.0.0.1:6379<span class="token operator">></span> keys *
1<span class="token punctuation">)</span> <span class="token string">"age"</span>
127.0.0.1:6379<span class="token operator">></span> <span class="token keyword">set</span> name qinjiang
OK
127.0.0.1:6379<span class="token operator">></span> keys *
1<span class="token punctuation">)</span> <span class="token string">"age"</span>
2<span class="token punctuation">)</span> <span class="token string">"name"</span>
127.0.0.1:6379<span class="token operator">></span> keys *
1<span class="token punctuation">)</span> <span class="token string">"age"</span>
2<span class="token punctuation">)</span> <span class="token string">"name"</span>
127.0.0.1:6379<span class="token operator">></span> get name
<span class="token string">"qinjiang"</span>
127.0.0.1:6379<span class="token operator">></span> EXPIRE name 10 <span class="token comment" spellcheck="true"># 设置key的过期时间，单位是秒</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> 1
127.0.0.1:6379<span class="token operator">></span> ttl name <span class="token comment" spellcheck="true"># 查看当前key的剩余时间</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> 4
127.0.0.1:6379<span class="token operator">></span> get name
<span class="token punctuation">(</span>nil<span class="token punctuation">)</span>
127.0.0.1:6379<span class="token operator">></span> <span class="token function">type</span> name <span class="token comment" spellcheck="true"># 查看当前key的一个类型！</span>
string<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>后面如果遇到不会的命令，可以在官网查看帮助文档！</p>
<p><img src="/2020/07/28/redis/image-20200524105013244.png"></p>
<h2 id="String（字符串）"><a href="#String（字符串）" class="headerlink" title="String（字符串）"></a>String（字符串）</h2><p>90% 的 java程序员使用 redis 只会使用一个String类型！</p>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token comment" spellcheck="true">#############################################################################</span>
127.0.0.1:6379<span class="token operator">></span> keys *            <span class="token comment" spellcheck="true"># 获得所有的key    </span>
<span class="token punctuation">(</span>empty list or set<span class="token punctuation">)</span>
127.0.0.1:6379<span class="token operator">></span> <span class="token keyword">set</span> k1 v1        <span class="token comment" spellcheck="true"># 设置值</span>
OK
127.0.0.1:6379<span class="token operator">></span> get k1            <span class="token comment" spellcheck="true"># 获得值</span>
<span class="token string">"v1"</span>
127.0.0.1:6379<span class="token operator">></span> EXISTS k1        <span class="token comment" spellcheck="true"># 判断某一个key是否存在</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> 1
127.0.0.1:6379<span class="token operator">></span> EXISTS k2
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> 0
127.0.0.1:6379<span class="token operator">></span> APPEND k1 hello    <span class="token comment" spellcheck="true"># 追加字符串，如果当前key不存在，就相当于setkey</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> 7
127.0.0.1:6379<span class="token operator">></span> get k1
<span class="token string">"v1hello"</span>
127.0.0.1:6379<span class="token operator">></span> STRLEN k1    <span class="token comment" spellcheck="true"># 获取字符串的长度</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> 7
127.0.0.1:6379<span class="token operator">></span> keys *
1<span class="token punctuation">)</span> <span class="token string">"k1"</span>
127.0.0.1:6379<span class="token operator">></span> APPEND k2 hellok2    <span class="token comment" spellcheck="true"># 追加字符串，如果当前key不存在，就相当于setkey</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> 7
127.0.0.1:6379<span class="token operator">></span> get k2
<span class="token string">"hellok2"</span>
<span class="token comment" spellcheck="true">#############################################################################</span>
<span class="token comment" spellcheck="true"># i++</span>
<span class="token comment" spellcheck="true"># 步长 i+=</span>
127.0.0.1:6379<span class="token operator">></span> <span class="token function">clear</span>
127.0.0.1:6379<span class="token operator">></span> <span class="token keyword">set</span> views 0        <span class="token comment" spellcheck="true"># 初始浏览量为0</span>
OK
127.0.0.1:6379<span class="token operator">></span> INCR views        <span class="token comment" spellcheck="true"># 自增1 浏览量变为1</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> 1
127.0.0.1:6379<span class="token operator">></span> INCR views        <span class="token comment" spellcheck="true"># 如果incr的对象不是一个数字，会报错；</span>
                                <span class="token comment" spellcheck="true"># 如果超出long long范围，会报错</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> 2
127.0.0.1:6379<span class="token operator">></span> get views
<span class="token string">"2"</span>
127.0.0.1:6379<span class="token operator">></span> DECR views        <span class="token comment" spellcheck="true"># 自减1 浏览量-1</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> 1
127.0.0.1:6379<span class="token operator">></span> INCRBY views 5    <span class="token comment" spellcheck="true"># 可以设置步长，指定增量！</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> 6
127.0.0.1:6379<span class="token operator">></span> DECRBY views 3    <span class="token comment" spellcheck="true"># 可以设置步长，指定减量！</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> 3
127.0.0.1:6379<span class="token operator">></span> get views
<span class="token string">"3"</span>
<span class="token comment" spellcheck="true">#############################################################################</span>
<span class="token comment" spellcheck="true"># 字符串范围 range</span>
127.0.0.1:6379<span class="token operator">></span> <span class="token keyword">set</span> key1 <span class="token string">"hello"</span> <span class="token comment" spellcheck="true"># 设置 key1 的值</span>
OK
127.0.0.1:6379<span class="token operator">></span> get key1
<span class="token string">"hello"</span>
127.0.0.1:6379<span class="token operator">></span> GETRANGE key1 0 3 <span class="token comment" spellcheck="true"># 截取字符串 [0,3]</span>
<span class="token string">"hell"</span>
127.0.0.1:6379<span class="token operator">></span> GETRANGE key1 0 -1 <span class="token comment" spellcheck="true"># 获取全部的字符串 和 get key是一样的</span>
<span class="token string">"hello"</span>
<span class="token comment" spellcheck="true"># 替换！</span>
127.0.0.1:6379<span class="token operator">></span> <span class="token keyword">set</span> key2 abcdefg
OK
127.0.0.1:6379<span class="token operator">></span> get key2
<span class="token string">"abcdefg"</span>
127.0.0.1:6379<span class="token operator">></span> SETRANGE key2 1 xx <span class="token comment" spellcheck="true"># 替换指定位置开始的字符串！</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> 7
127.0.0.1:6379<span class="token operator">></span> get key2
<span class="token string">"axxdefg"</span>
<span class="token comment" spellcheck="true">#############################################################################</span>
<span class="token comment" spellcheck="true"># setex (set with expire) # 设置过期时间</span>
<span class="token comment" spellcheck="true"># setnx (set if not exist) # 不存在在设置 （在分布式锁中会常常使用！）</span>
127.0.0.1:6379<span class="token operator">></span> setex key3 30 <span class="token string">"hello"</span> <span class="token comment" spellcheck="true"># 设置key3 的值为 hello,30秒后过期</span>
OK
127.0.0.1:6379<span class="token operator">></span> ttl key3
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> 26
127.0.0.1:6379<span class="token operator">></span> get key3
<span class="token string">"hello"</span>
127.0.0.1:6379<span class="token operator">></span> setnx mykey <span class="token string">"redis"</span> <span class="token comment" spellcheck="true"># 如果mykey 不存在，创建mykey</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> 1
127.0.0.1:6379<span class="token operator">></span> keys *
1<span class="token punctuation">)</span> <span class="token string">"key2"</span>
2<span class="token punctuation">)</span> <span class="token string">"mykey"</span>
3<span class="token punctuation">)</span> <span class="token string">"key1"</span>
127.0.0.1:6379<span class="token operator">></span> ttl key3
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> -2
127.0.0.1:6379<span class="token operator">></span> setnx mykey <span class="token string">"MongoDB"</span> <span class="token comment" spellcheck="true"># 如果mykey存在，创建失败！</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> 0
127.0.0.1:6379<span class="token operator">></span> get mykey
<span class="token string">"redis"</span>
<span class="token comment" spellcheck="true">#############################################################################</span>
<span class="token comment" spellcheck="true"># mset</span>
<span class="token comment" spellcheck="true"># mget</span>
127.0.0.1:6379<span class="token operator">></span> mset k1 v1 k2 v2 k3 v3 <span class="token comment" spellcheck="true"># 同时设置多个值</span>
OK
127.0.0.1:6379<span class="token operator">></span> keys *
1<span class="token punctuation">)</span> <span class="token string">"k1"</span>
2<span class="token punctuation">)</span> <span class="token string">"k2"</span>
3<span class="token punctuation">)</span> <span class="token string">"k3"</span>
127.0.0.1:6379<span class="token operator">></span> mget k1 k2 k3 <span class="token comment" spellcheck="true"># 同时获取多个值</span>
1<span class="token punctuation">)</span> <span class="token string">"v1"</span>
2<span class="token punctuation">)</span> <span class="token string">"v2"</span>
3<span class="token punctuation">)</span> <span class="token string">"v3"</span>
127.0.0.1:6379<span class="token operator">></span> msetnx k1 v1 k4 v4 <span class="token comment" spellcheck="true"># msetnx 是一个原子性的操作，要么一起成功，要么一起失败！</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> 0
127.0.0.1:6379<span class="token operator">></span> get k4
<span class="token punctuation">(</span>nil<span class="token punctuation">)</span>
<span class="token comment" spellcheck="true">#############################################################################</span>
<span class="token comment" spellcheck="true"># 对象</span>
<span class="token keyword">set</span> user:1 <span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123;name:zhangsan,age:3&amp;#125; # 设置一个user:1 对象 值为 json字符来保存一个对象！</span>
<span class="token comment" spellcheck="true"># 这里的key是一个巧妙的设计： user:&amp;#123;id&amp;#125;:&amp;#123;filed&amp;#125; , 如此设计在Redis中是完全OK了！</span>
127.0.0.1:6379<span class="token operator">></span> mset user:1:name zhangsan user:1:age 2
OK
127.0.0.1:6379<span class="token operator">></span> mget user:1:name user:1:age
1<span class="token punctuation">)</span> <span class="token string">"zhangsan"</span>
2<span class="token punctuation">)</span> <span class="token string">"2"</span>
<span class="token comment" spellcheck="true">##########################################################################</span>
<span class="token comment" spellcheck="true"># getset  先get然后在set</span>
127.0.0.1:6379<span class="token operator">></span> getset db redis <span class="token comment" spellcheck="true"># 如果不存在值，则返回 nil</span>
<span class="token punctuation">(</span>nil<span class="token punctuation">)</span>
127.0.0.1:6379<span class="token operator">></span> get db
<span class="token string">"redis
127.0.0.1:6379> getset db mongodb # 如果存在值，获取原来的值，并设置新的值
"</span>redis<span class="token string">"
127.0.0.1:6379> get db
"</span>mongodb"<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>数据结构是相同的！</p>
<p>String类似的使用场景：value除了是我们的字符串还可以是我们的数字！</p>
<ul>
<li><p>计数器 </p>
</li>
<li><p>统计多单位的数量 </p>
</li>
<li><p>粉丝数 </p>
</li>
<li><p>对象缓存存储</p>
</li>
</ul>
<h2 id="List（列表）"><a href="#List（列表）" class="headerlink" title="List（列表）"></a>List（列表）</h2><p>基本的数据类型，列表 </p>
<p>图一：</p>
<p><img src="/2020/07/28/redis/list.png"></p>
<p>在redis里面，我们可以把list玩成栈、队列、阻塞队列！ </p>
<p><strong>所有的list命令都是用l开头的</strong>，Redis的命令不区分大小</p>
<blockquote>
<p>演示案例</p>
</blockquote>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># 案例一：LPUSH将一个值或多个值插入到列表的头部(图一的左边插入）)</span>
127.0.0.1:6379<span class="token operator">></span> flushdb        <span class="token comment" spellcheck="true">#避免干扰，先清空当前数据库</span>
OK
127.0.0.1:6379<span class="token operator">></span> keys *
<span class="token punctuation">(</span>empty array<span class="token punctuation">)</span>
127.0.0.1:6379<span class="token operator">></span> LPUSH list one            <span class="token comment" spellcheck="true"># 将一个值或多个值插入到列表的头部（左）</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> 1
127.0.0.1:6379<span class="token operator">></span> LPUSH list two            <span class="token comment" spellcheck="true"># key=list,value=two</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> 2
127.0.0.1:6379<span class="token operator">></span> LPUSH list three        <span class="token comment" spellcheck="true"># key=list,value=three</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> 3
127.0.0.1:6379<span class="token operator">></span> LRANGE list 0 -1        <span class="token comment" spellcheck="true">#（L从左边）取出key=list的所有值，先取的three，说明该List可以玩成栈的结构</span>
1<span class="token punctuation">)</span> <span class="token string">"three"</span>
2<span class="token punctuation">)</span> <span class="token string">"two"</span>
3<span class="token punctuation">)</span> <span class="token string">"one"</span>
127.0.0.1:6379<span class="token operator">></span> LRANGE list 0 1            <span class="token comment" spellcheck="true">#（L从左边）取出key=list索引为[0,1]的值</span>
1<span class="token punctuation">)</span> <span class="token string">"three"</span>
2<span class="token punctuation">)</span> <span class="token string">"two"</span>
127.0.0.1:6379<span class="token operator">></span> RPUSH list right        <span class="token comment" spellcheck="true"># 将一个值或多个值插入到列表的尾部（右）</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> 4
127.0.0.1:6379<span class="token operator">></span> LRANGE list 0 -1        <span class="token comment" spellcheck="true">#（L从左边）取出列表名为list的所有值</span>
1<span class="token punctuation">)</span> <span class="token string">"three"</span>
2<span class="token punctuation">)</span> <span class="token string">"two"</span>
3<span class="token punctuation">)</span> <span class="token string">"one"</span>
4<span class="token punctuation">)</span> <span class="token string">"right"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># Lpop Rpop</span>
127.0.0.1:6379<span class="token operator">></span> LRANGE list 0 -1
1<span class="token punctuation">)</span> <span class="token string">"three"</span>
2<span class="token punctuation">)</span> <span class="token string">"two"</span>
3<span class="token punctuation">)</span> <span class="token string">"one"</span>
4<span class="token punctuation">)</span> <span class="token string">"right"</span>
127.0.0.1:6379<span class="token operator">></span> LPOP list            <span class="token comment" spellcheck="true"># 移除list的第一个元素</span>
<span class="token string">"three"</span>
127.0.0.1:6379<span class="token operator">></span> RPOP list            <span class="token comment" spellcheck="true"># 移除list的最后一个元素</span>
<span class="token string">"right"</span>
127.0.0.1:6379<span class="token operator">></span> LRANGE list 0 -1
1<span class="token punctuation">)</span> <span class="token string">"two"</span>
2<span class="token punctuation">)</span> <span class="token string">"one"</span>
<span class="token comment" spellcheck="true">#####################################################################</span>
<span class="token comment" spellcheck="true"># Lindex 通过下标获取List的某个值</span>
<span class="token comment" spellcheck="true"># Llen 判断List的长度</span>
127.0.0.1:6379<span class="token operator">></span> LINDEX list 1
<span class="token string">"one"</span>
127.0.0.1:6379<span class="token operator">></span> LINDEX list 0
<span class="token string">"two"</span>
127.0.0.1:6379<span class="token operator">></span>  Llen list
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> 2
<span class="token comment" spellcheck="true">##################################################################</span>
<span class="token comment" spellcheck="true"># Lrem key count element 移除指定的值</span>
127.0.0.1:6379<span class="token operator">></span> LRANGE list 0 -1
1<span class="token punctuation">)</span> <span class="token string">"two"</span>
2<span class="token punctuation">)</span> <span class="token string">"one"</span>
127.0.0.1:6379<span class="token operator">></span> LPUSH list two
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> 3
127.0.0.1:6379<span class="token operator">></span> LRANGE list 0 -1        <span class="token comment" spellcheck="true"># List允许重复值</span>
1<span class="token punctuation">)</span> <span class="token string">"two"</span>
2<span class="token punctuation">)</span> <span class="token string">"two"</span>
3<span class="token punctuation">)</span> <span class="token string">"one"</span>
127.0.0.1:6379<span class="token operator">></span> LREM list 1 one            <span class="token comment" spellcheck="true"># 从头到尾移除掉list的一个two</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> 1
127.0.0.1:6379<span class="token operator">></span> LRANGE list 0 -1
1<span class="token punctuation">)</span> <span class="token string">"two"</span>
2<span class="token punctuation">)</span> <span class="token string">"two"</span>
127.0.0.1:6379<span class="token operator">></span> LREM list 2 two            <span class="token comment" spellcheck="true">#移除list中的掉两个two</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> 2
127.0.0.1:6379<span class="token operator">></span> LRANGE list 0 -1
<span class="token punctuation">(</span>empty array<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># trim 修剪</span>
127.0.0.1:6379<span class="token operator">></span> keys *
<span class="token punctuation">(</span>empty list or set<span class="token punctuation">)</span>
127.0.0.1:6379<span class="token operator">></span> Rpush mylist <span class="token string">"hello"</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> 1
127.0.0.1:6379<span class="token operator">></span> Rpush mylist <span class="token string">"hello1"</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> 2
127.0.0.1:6379<span class="token operator">></span> Rpush mylist <span class="token string">"hello2"</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> 3
127.0.0.1:6379<span class="token operator">></span> Rpush mylist <span class="token string">"hello3"</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> 4
127.0.0.1:6379<span class="token operator">></span> ltrim mylist 1 2 <span class="token comment" spellcheck="true"># 通过下标截取指定的长度，这个List已经被改变了，截断了只剩下截取的元素！</span>
OK
127.0.0.1:6379<span class="token operator">></span> LRANGE mylist 0 -1
1<span class="token punctuation">)</span> <span class="token string">"hello1"</span>
2<span class="token punctuation">)</span> <span class="token string">"hello2"</span>
<span class="token comment" spellcheck="true">#########################################################################</span>
rpoplpush <span class="token comment" spellcheck="true"># 移除列表的最后一个元素，将他移动到新的列表中！</span>
127.0.0.1:6379<span class="token operator">></span> rpush mylist <span class="token string">"hello"</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> 1
127.0.0.1:6379<span class="token operator">></span> rpush mylist <span class="token string">"hello1"</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> 2
127.0.0.1:6379<span class="token operator">></span> rpush mylist <span class="token string">"hello2"</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> 3
127.0.0.1:6379<span class="token operator">></span> rpoplpush mylist myotherlist <span class="token comment" spellcheck="true"># 移除列表的最后一个元素，将他移动到新的</span>
列表中！
<span class="token string">"hello2"</span>
127.0.0.1:6379<span class="token operator">></span> lrange mylist 0 -1 <span class="token comment" spellcheck="true"># 查看原来的列表</span>
1<span class="token punctuation">)</span> <span class="token string">"hello"</span>
2<span class="token punctuation">)</span> <span class="token string">"hello1"</span>
127.0.0.1:6379<span class="token operator">></span> lrange myotherlist 0 -1 <span class="token comment" spellcheck="true"># 查看目标列表中，确实存在改值！</span>
1<span class="token punctuation">)</span> <span class="token string">"hello2"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># lset 将列表中指定下标的值替换为另外一个值，更新操作</span>
127.0.0.1:6379<span class="token operator">></span> EXISTS list <span class="token comment" spellcheck="true"># 判断这个列表是否存在</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> 0
127.0.0.1:6379<span class="token operator">></span> lset list 0 item <span class="token comment" spellcheck="true"># 如果不存在列表我们去更新就会报错</span>
<span class="token punctuation">(</span>error<span class="token punctuation">)</span> ERR no such key
127.0.0.1:6379<span class="token operator">></span> lpush list value1
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> 1
127.0.0.1:6379<span class="token operator">></span> LRANGE list 0 0
1<span class="token punctuation">)</span> <span class="token string">"value1"</span>
127.0.0.1:6379<span class="token operator">></span> lset list 0 item <span class="token comment" spellcheck="true"># 如果存在，更新当前下标的值</span>
OK
127.0.0.1:6379<span class="token operator">></span> LRANGE list 0 0
1<span class="token punctuation">)</span> <span class="token string">"item"</span>
127.0.0.1:6379<span class="token operator">></span> lset list 1 other <span class="token comment" spellcheck="true"># 如果不存在，则会报错！</span>
<span class="token punctuation">(</span>error<span class="token punctuation">)</span> ERR index out of range
<span class="token comment" spellcheck="true">#########################################################################</span>
linsert <span class="token comment" spellcheck="true"># 将某个具体的value插入到列把你中某个元素的前面或者后面！</span>
127.0.0.1:6379<span class="token operator">></span> Rpush mylist <span class="token string">"hello"</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> 1
127.0.0.1:6379<span class="token operator">></span> Rpush mylist <span class="token string">"world"</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> 2
127.0.0.1:6379<span class="token operator">></span> LINSERT mylist before <span class="token string">"world"</span> <span class="token string">"other"</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> 3
127.0.0.1:6379<span class="token operator">></span> LRANGE mylist 0 -1
1<span class="token punctuation">)</span> <span class="token string">"hello"</span>
2<span class="token punctuation">)</span> <span class="token string">"other"</span>
3<span class="token punctuation">)</span> <span class="token string">"world"</span>
127.0.0.1:6379<span class="token operator">></span> LINSERT mylist after world new
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> 4
127.0.0.1:6379<span class="token operator">></span> LRANGE mylist 0 -1
1<span class="token punctuation">)</span> <span class="token string">"hello"</span>
2<span class="token punctuation">)</span> <span class="token string">"other"</span>
3<span class="token punctuation">)</span> <span class="token string">"world"</span>
4<span class="token punctuation">)</span> <span class="token string">"new"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p>小结</p>
</blockquote>
<ul>
<li>他实际上是一个链表，before Node after ， left，right 都可以插入值</li>
<li>如果key 不存在，创建新的链表</li>
<li>如果key存在，新增内容</li>
<li>如果移除了所有值，空链表，也代表不存在！ </li>
<li>在两边插入或者改动值，效率最高！ 中间元素，相对来说效率会低一点~</li>
</ul>
<p>消息排队！消息队列 （Lpush Rpop）， 栈（ Lpush Lpop）！</p>
<h2 id="Set（集合）"><a href="#Set（集合）" class="headerlink" title="Set（集合）"></a>Set（集合）</h2><p>set中的值是不能重读的！</p>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token comment" spellcheck="true">##########################################################################</span>
127.0.0.1:6379<span class="token operator">></span> sadd myset <span class="token string">"hello"</span> <span class="token comment" spellcheck="true"># set集合中添加元素</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> 1
127.0.0.1:6379<span class="token operator">></span> sadd myset <span class="token string">"kuangshen"</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> 1
127.0.0.1:6379<span class="token operator">></span> sadd myset <span class="token string">"lovekuangshen"</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> 1
127.0.0.1:6379<span class="token operator">></span> SMEMBERS myset <span class="token comment" spellcheck="true"># 查看指定set的所有值</span>
1<span class="token punctuation">)</span> <span class="token string">"hello"</span>
2<span class="token punctuation">)</span> <span class="token string">"lovekuangshen"</span>
3<span class="token punctuation">)</span> <span class="token string">"kuangshen"</span>
127.0.0.1:6379<span class="token operator">></span> SISMEMBER myset hello <span class="token comment" spellcheck="true"># 判断某一个值是不是在set集合中！</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> 1
127.0.0.1:6379<span class="token operator">></span> SISMEMBER myset world
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> 0
<span class="token comment" spellcheck="true">##########################################################################</span>
127.0.0.1:6379<span class="token operator">></span> scard myset <span class="token comment" spellcheck="true"># 获取set集合中的内容元素个数！</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> 4
<span class="token comment" spellcheck="true">##########################################################################</span>
rem
127.0.0.1:6379<span class="token operator">></span> srem myset hello <span class="token comment" spellcheck="true"># 移除set集合中的指定元素</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> 1
127.0.0.1:6379<span class="token operator">></span> scard myset
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> 3
127.0.0.1:6379<span class="token operator">></span> SMEMBERS myset
1<span class="token punctuation">)</span> <span class="token string">"lovekuangshen2"</span>
2<span class="token punctuation">)</span> <span class="token string">"lovekuangshen"</span>
3<span class="token punctuation">)</span> <span class="token string">"kuangshen"</span>
<span class="token comment" spellcheck="true">##########################################################################</span>
<span class="token keyword">set</span> 无序不重复集合。抽随机！
127.0.0.1:6379<span class="token operator">></span> SMEMBERS myset
1<span class="token punctuation">)</span> <span class="token string">"lovekuangshen2"</span>
2<span class="token punctuation">)</span> <span class="token string">"lovekuangshen"</span>
3<span class="token punctuation">)</span> <span class="token string">"kuangshen"</span>
127.0.0.1:6379<span class="token operator">></span> SRANDMEMBER myset <span class="token comment" spellcheck="true"># 随机抽选出一个元素</span>
<span class="token string">"kuangshen"</span>
127.0.0.1:6379<span class="token operator">></span> SRANDMEMBER myset
<span class="token string">"kuangshen"</span>
127.0.0.1:6379<span class="token operator">></span> SRANDMEMBER myset
<span class="token string">"kuangshen"</span>
127.0.0.1:6379<span class="token operator">></span> SRANDMEMBER myset
<span class="token string">"kuangshen"</span>
127.0.0.1:6379<span class="token operator">></span> SRANDMEMBER myset 2 <span class="token comment" spellcheck="true"># 随机抽选出指定个数的元素</span>
1<span class="token punctuation">)</span> <span class="token string">"lovekuangshen"</span>
2<span class="token punctuation">)</span> <span class="token string">"lovekuangshen2"</span>
127.0.0.1:6379<span class="token operator">></span> SRANDMEMBER myset 2
1<span class="token punctuation">)</span> <span class="token string">"lovekuangshen"</span>
2<span class="token punctuation">)</span> <span class="token string">"lovekuangshen2"</span>
127.0.0.1:6379<span class="token operator">></span> SRANDMEMBER myset <span class="token comment" spellcheck="true"># 随机抽选出一个元素</span>
<span class="token string">"lovekuangshen2"</span>
<span class="token comment" spellcheck="true">##########################################################################</span>
删除定的key，随机删除key！
127.0.0.1:6379<span class="token operator">></span> SMEMBERS myset
1<span class="token punctuation">)</span> <span class="token string">"lovekuangshen2"</span>
2<span class="token punctuation">)</span> <span class="token string">"lovekuangshen"</span>
3<span class="token punctuation">)</span> <span class="token string">"kuangshen"</span>
127.0.0.1:6379<span class="token operator">></span> spop myset <span class="token comment" spellcheck="true"># 随机删除一些set集合中的元素！</span>
<span class="token string">"lovekuangshen2"</span>
127.0.0.1:6379<span class="token operator">></span> spop myset
<span class="token string">"lovekuangshen"</span>
127.0.0.1:6379<span class="token operator">></span> SMEMBERS myset
1<span class="token punctuation">)</span> <span class="token string">"kuangshen"</span>
<span class="token comment" spellcheck="true">##########################################################################</span>
将一个指定的值，移动到另外一个set集合！
127.0.0.1:6379<span class="token operator">></span> sadd myset <span class="token string">"hello"</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> 1
127.0.0.1:6379<span class="token operator">></span> sadd myset <span class="token string">"world"</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> 1
127.0.0.1:6379<span class="token operator">></span> sadd myset <span class="token string">"kuangshen"</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> 1
127.0.0.1:6379<span class="token operator">></span> sadd myset2 <span class="token string">"set2"</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> 1
127.0.0.1:6379<span class="token operator">></span> smove myset myset2 <span class="token string">"kuangshen"</span> <span class="token comment" spellcheck="true"># 将一个指定的值，移动到另外一个set集</span>
合！
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> 1
127.0.0.1:6379<span class="token operator">></span> SMEMBERS myset
1<span class="token punctuation">)</span> <span class="token string">"world"</span>
2<span class="token punctuation">)</span> <span class="token string">"hello"</span>
127.0.0.1:6379<span class="token operator">></span> SMEMBERS myset2
1<span class="token punctuation">)</span> <span class="token string">"kuangshen"</span>
2<span class="token punctuation">)</span> <span class="token string">"set2"</span>
<span class="token comment" spellcheck="true">##########################################################################</span>
微博，B站，共同关注！<span class="token punctuation">(</span>并集<span class="token punctuation">)</span>
数字集合类：
- 差集 SDIFF
- 交集 SINTER
- 并集 SUNION
127.0.0.1:6379<span class="token operator">></span> SDIFF key1 key2 <span class="token comment" spellcheck="true"># 差集</span>
1<span class="token punctuation">)</span> <span class="token string">"b"</span>
2<span class="token punctuation">)</span> <span class="token string">"a"</span>
127.0.0.1:6379<span class="token operator">></span> SINTER key1 key2 <span class="token comment" spellcheck="true"># 交集 共同好友就可以这样实现</span>
1<span class="token punctuation">)</span> <span class="token string">"c"</span>
127.0.0.1:6379<span class="token operator">></span> SUNION key1 key2 <span class="token comment" spellcheck="true"># 并集</span>
1<span class="token punctuation">)</span> <span class="token string">"b"</span>
2<span class="token punctuation">)</span> <span class="token string">"c"</span>
3<span class="token punctuation">)</span> <span class="token string">"e"</span>
4<span class="token punctuation">)</span> <span class="token string">"a"</span>
5<span class="token punctuation">)</span> <span class="token string">"d"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>微博，A用户将所有关注的人放在一个set集合中！将它的粉丝也放在一个集合中！ 共同关注，共同爱好，二度好友，推荐好友！（六度分割理论）</p>
<h2 id="Hash"><a href="#Hash" class="headerlink" title="Hash"></a>Hash</h2><p>Map集合，key-map! 时候这个值是一个map集合！ 本质和String类型没有太大区别，还是一个简单的 key-value！ </p>
<p>set myhash field kuangshen</p>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token comment" spellcheck="true">##########################################################################</span>
127.0.0.1:6379<span class="token operator">></span> hset myhash field1 kuangshen <span class="token comment" spellcheck="true"># set一个具体 key-vlaue</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> 1
127.0.0.1:6379<span class="token operator">></span> hget myhash field1 <span class="token comment" spellcheck="true"># 获取一个字段值</span>
<span class="token string">"kuangshen"</span>
127.0.0.1:6379<span class="token operator">></span> hmset myhash field1 hello field2 world <span class="token comment" spellcheck="true"># set多个 key-vlaue</span>
OK
127.0.0.1:6379<span class="token operator">></span> hmget myhash field1 field2 <span class="token comment" spellcheck="true"># 获取多个字段值</span>
1<span class="token punctuation">)</span> <span class="token string">"hello"</span>
2<span class="token punctuation">)</span> <span class="token string">"world"</span>
127.0.0.1:6379<span class="token operator">></span> hgetall myhash <span class="token comment" spellcheck="true"># 获取全部的数据，</span>
1<span class="token punctuation">)</span> <span class="token string">"field1"</span>
2<span class="token punctuation">)</span> <span class="token string">"hello"</span>
3<span class="token punctuation">)</span> <span class="token string">"field2"</span>
4<span class="token punctuation">)</span> <span class="token string">"world"</span>
127.0.0.1:6379<span class="token operator">></span> hdel myhash field1 <span class="token comment" spellcheck="true"># 删除hash指定key字段！对应的value值也就消失了！</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> 1
127.0.0.1:6379<span class="token operator">></span> hgetall myhash
1<span class="token punctuation">)</span> <span class="token string">"field2"</span>
2<span class="token punctuation">)</span> <span class="token string">"world"</span>
<span class="token comment" spellcheck="true">##########################################################################</span>
hlen
127.0.0.1:6379<span class="token operator">></span> hmset myhash field1 hello field2 world
OK
127.0.0.1:6379<span class="token operator">></span> HGETALL myhash
1<span class="token punctuation">)</span> <span class="token string">"field2"</span>
2<span class="token punctuation">)</span> <span class="token string">"world"</span>
3<span class="token punctuation">)</span> <span class="token string">"field1"</span>
4<span class="token punctuation">)</span> <span class="token string">"hello"</span>
127.0.0.1:6379<span class="token operator">></span> hlen myhash <span class="token comment" spellcheck="true"># 获取hash表的字段数量！</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> 2
<span class="token comment" spellcheck="true">##########################################################################</span>
127.0.0.1:6379<span class="token operator">></span> HEXISTS myhash field1 <span class="token comment" spellcheck="true"># 判断hash中指定字段是否存在！</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> 1
127.0.0.1:6379<span class="token operator">></span> HEXISTS myhash field3
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> 0
<span class="token comment" spellcheck="true">##########################################################################</span>
<span class="token comment" spellcheck="true"># 只获得所有field</span>
<span class="token comment" spellcheck="true"># 只获得所有value</span>
127.0.0.1:6379<span class="token operator">></span> hkeys myhash <span class="token comment" spellcheck="true"># 只获得所有field</span>
1<span class="token punctuation">)</span> <span class="token string">"field2"</span>
2<span class="token punctuation">)</span> <span class="token string">"field1"</span>
127.0.0.1:6379<span class="token operator">></span> hvals myhash <span class="token comment" spellcheck="true"># 只获得所有value</span>
1<span class="token punctuation">)</span> <span class="token string">"world"</span>
2<span class="token punctuation">)</span> <span class="token string">"hello"</span>
<span class="token comment" spellcheck="true">##########################################################################</span>
incr decr
127.0.0.1:6379<span class="token operator">></span> hset myhash field3 5 <span class="token comment" spellcheck="true">#指定增量！</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> 1
127.0.0.1:6379<span class="token operator">></span> HINCRBY myhash field3 1
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> 6
127.0.0.1:6379<span class="token operator">></span> HINCRBY myhash field3 -1
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> 5
127.0.0.1:6379<span class="token operator">></span> hsetnx myhash field4 hello <span class="token comment" spellcheck="true"># 如果不存在则可以设置</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> 1
127.0.0.1:6379<span class="token operator">></span> hsetnx myhash field4 world <span class="token comment" spellcheck="true"># 如果存在则不能设置</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> 0<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>hash变更的数据 user name age,尤其是是用户信息之类的，经常变动的信息！ hash 更适合于对象的 存储，String更加适合字符串存储！</p>
<h2 id="Zset（有序集合）"><a href="#Zset（有序集合）" class="headerlink" title="Zset（有序集合）"></a>Zset（有序集合）</h2><p>在set的基础上，增加了一个值，set k1 v1 zset k1 score1 v1</p>
<pre class="line-numbers language-bash"><code class="language-bash">127.0.0.1:6379<span class="token operator">></span> zadd myset 1 one <span class="token comment" spellcheck="true"># 添加一个值</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> 1
127.0.0.1:6379<span class="token operator">></span> zadd myset 2 two 3 three <span class="token comment" spellcheck="true"># 添加多个值</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> 2
127.0.0.1:6379<span class="token operator">></span> ZRANGE myset 0 -1
1<span class="token punctuation">)</span> <span class="token string">"one"</span>
2<span class="token punctuation">)</span> <span class="token string">"two"</span>
3<span class="token punctuation">)</span> <span class="token string">"three"</span>
<span class="token comment" spellcheck="true">##########################################################################</span>
排序如何实现
127.0.0.1:6379<span class="token operator">></span> zadd salary 2500 xiaohong <span class="token comment" spellcheck="true"># 添加三个用户</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> 1
127.0.0.1:6379<span class="token operator">></span> zadd salary 5000 zhangsan
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> 1
127.0.0.1:6379<span class="token operator">></span> zadd salary 500 kaungshen
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> 1
<span class="token comment" spellcheck="true"># ZRANGEBYSCORE key min max</span>
127.0.0.1:6379<span class="token operator">></span> ZRANGEBYSCORE salary -inf +inf <span class="token comment" spellcheck="true"># 显示全部的用户 从小到大！</span>
1<span class="token punctuation">)</span> <span class="token string">"kaungshen"</span>
2<span class="token punctuation">)</span> <span class="token string">"xiaohong"</span>
3<span class="token punctuation">)</span> <span class="token string">"zhangsan"</span>
127.0.0.1:6379<span class="token operator">></span> ZREVRANGE salary 0 -1 <span class="token comment" spellcheck="true"># 从大到进行排序！</span>
1<span class="token punctuation">)</span> <span class="token string">"zhangsan"</span>
2<span class="token punctuation">)</span> <span class="token string">"kaungshen"</span>
127.0.0.1:6379<span class="token operator">></span> ZRANGEBYSCORE salary -inf +inf withscores <span class="token comment" spellcheck="true"># 显示全部的用户并且附带成绩</span>
1<span class="token punctuation">)</span> <span class="token string">"kaungshen"</span>
2<span class="token punctuation">)</span> <span class="token string">"500"</span>
3<span class="token punctuation">)</span> <span class="token string">"xiaohong"</span>
4<span class="token punctuation">)</span> <span class="token string">"2500"</span>
5<span class="token punctuation">)</span> <span class="token string">"zhangsan"</span>
6<span class="token punctuation">)</span> <span class="token string">"5000"</span>
127.0.0.1:6379<span class="token operator">></span> ZRANGEBYSCORE salary -inf 2500 withscores <span class="token comment" spellcheck="true"># 显示工资小于2500员工的升序排序！</span>
1<span class="token punctuation">)</span> <span class="token string">"kaungshen"</span>
2<span class="token punctuation">)</span> <span class="token string">"500"</span>
3<span class="token punctuation">)</span> <span class="token string">"xiaohong"</span>
4<span class="token punctuation">)</span> <span class="token string">"2500"</span>
<span class="token comment" spellcheck="true">##########################################################################</span>
<span class="token comment" spellcheck="true"># 移除rem中的元素</span>
127.0.0.1:6379<span class="token operator">></span> zrange salary 0 -1
1<span class="token punctuation">)</span> <span class="token string">"kaungshen"</span>
2<span class="token punctuation">)</span> <span class="token string">"xiaohong"</span>
3<span class="token punctuation">)</span> <span class="token string">"zhangsan"</span>
127.0.0.1:6379<span class="token operator">></span> zrem salary xiaohong <span class="token comment" spellcheck="true"># 移除有序集合中的指定元素</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> 1
127.0.0.1:6379<span class="token operator">></span> zrange salary 0 -1
1<span class="token punctuation">)</span> <span class="token string">"kaungshen"</span>
2<span class="token punctuation">)</span> <span class="token string">"zhangsan"</span>
127.0.0.1:6379<span class="token operator">></span> zcard salary <span class="token comment" spellcheck="true"># 获取有序集合中的个数</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> 2
<span class="token comment" spellcheck="true">##########################################################################</span>
127.0.0.1:6379<span class="token operator">></span> zadd myset 1 hello
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> 1
127.0.0.1:6379<span class="token operator">></span> zadd myset 2 world 3 kuangshen
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> 2
127.0.0.1:6379<span class="token operator">></span> zcount myset 1 3 <span class="token comment" spellcheck="true"># 获取指定区间的成员数量！</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> 3
127.0.0.1:6379<span class="token operator">></span> zcount myset 1 2
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> 2<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>其余的一些API，通过我们的学习，你们剩下的如果工作中有需要，这个时候你可以去查看官方文档！ </p>
<p>案例思路：set 排序 存储班级成绩表，工资表排序！ 普通消息，1， 重要消息 2，带权重进行判断！ </p>
<p>排行榜应用实现，取Top N 测试！</p>
<h1 id="三种特殊数据类型"><a href="#三种特殊数据类型" class="headerlink" title="三种特殊数据类型"></a>三种特殊数据类型</h1><h2 id="Geospatial-地理位置"><a href="#Geospatial-地理位置" class="headerlink" title="Geospatial 地理位置"></a>Geospatial 地理位置</h2><p>朋友的定位，附近的人，打车距离计算？</p>
<p>Redis 的 Geo 在Redis3.2 版本就推出了！这个功能可以推算地理位置的信息，两地之间的距离，方圆几里的人！</p>
<p>可以查询一些测试数据：<a href="http://www.jsons.cn/lngcodeinfo/0706D99C19A781A3/" target="_blank" rel="noopener">http://www.jsons.cn/lngcodeinfo/0706D99C19A781A3/</a></p>
<p>只有六个命令：</p>
<p><img src="https://gitee.com/yuankeyuan/picture_bed/raw/master/redis/image-20200606014104198.png" alt="image-20200606014104198"></p>
<p>官方文档：<a href="https://www.redis.net.cn/order/3685.html" target="_blank" rel="noopener">https://www.redis.net.cn/order/3685.html</a></p>
<blockquote>
<p>getadd</p>
</blockquote>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># getadd 添加地理位置</span>
<span class="token comment" spellcheck="true"># 规则：两级无法直接添加，我们一般会下载城市数据，直接通过java程序一次性导入！</span>
<span class="token comment" spellcheck="true"># 有效的经度从-180度到180度。</span>
<span class="token comment" spellcheck="true"># 有效的纬度从-85.05112878度到85.05112878度。</span>
<span class="token comment" spellcheck="true"># 当坐标位置超出上述指定范围时，该命令将会返回一个错误。</span>
<span class="token comment" spellcheck="true"># 127.0.0.1:6379> geoadd china:city 39.90 116.40 beijin</span>
<span class="token punctuation">(</span>error<span class="token punctuation">)</span> ERR invalid longitude,latitude pair 39.900000,116.400000
<span class="token comment" spellcheck="true"># 参数 key 值（）</span>
127.0.0.1:6379<span class="token operator">></span> geoadd china:city 116.40 39.90 beijing
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> 1
127.0.0.1:6379<span class="token operator">></span> geoadd china:city 121.47 31.23 shanghai
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> 1
127.0.0.1:6379<span class="token operator">></span> geoadd china:city 106.50 29.53 chongqi 114.05 22.52 shengzhen
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> 2
127.0.0.1:6379<span class="token operator">></span> geoadd china:city 120.16 30.24 hangzhou 108.96 34.26 xian
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> 2<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p>getpos</p>
</blockquote>
<p>获得当前定位：一定是一个坐标值！</p>
<pre class="line-numbers language-bash"><code class="language-bash">127.0.0.1:6379<span class="token operator">></span> GEOPOS china:city beijing <span class="token comment" spellcheck="true"># 获取指定的城市的经度和纬度！</span>
1<span class="token punctuation">)</span> 1<span class="token punctuation">)</span> <span class="token string">"116.39999896287918091"</span>
2<span class="token punctuation">)</span> <span class="token string">"39.90000009167092543"</span>
127.0.0.1:6379<span class="token operator">></span> GEOPOS china:city beijing chongqi
1<span class="token punctuation">)</span> 1<span class="token punctuation">)</span> <span class="token string">"116.39999896287918091"</span>
2<span class="token punctuation">)</span> <span class="token string">"39.90000009167092543"</span>
2<span class="token punctuation">)</span> 1<span class="token punctuation">)</span> <span class="token string">"106.49999767541885376"</span>
2<span class="token punctuation">)</span> <span class="token string">"29.52999957900659211"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p>GEODIST</p>
</blockquote>
<p>两人之间的距离！ 单位： m 表示单位为米。 km 表示单位为千米。 mi 表示单位为英里。 ft 表示单位为英尺。</p>
<pre class="line-numbers language-bash"><code class="language-bash">127.0.0.1:6379<span class="token operator">></span> GEODIST china:city beijing shanghai km <span class="token comment" spellcheck="true"># 查看上海到北京的直线距离</span>
<span class="token string">"1067.3788"</span>
127.0.0.1:6379<span class="token operator">></span> GEODIST china:city beijing chongqi km <span class="token comment" spellcheck="true"># 查看重庆到北京的直线距离</span>
<span class="token string">"1464.0708"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p>georadius 以给定的经纬度为中心， 找出某一半径内的元素</p>
</blockquote>
<p>我附近的人？ （获得所有附近的人的地址，定位！）通过半径来查询！</p>
<p>获得指定数量的人，200</p>
<p>所有数据应该都录入：china:city ，才会让结果更加请求！</p>
<pre class="line-numbers language-bash"><code class="language-bash">127.0.0.1:6379<span class="token operator">></span> GEORADIUS china:city 110 30 1000 km <span class="token comment" spellcheck="true"># 以110，30 这个经纬度为中心，寻找方圆1000km内的城市</span>
1<span class="token punctuation">)</span> <span class="token string">"chongqi"</span>
2<span class="token punctuation">)</span> <span class="token string">"xian"</span>
3<span class="token punctuation">)</span> <span class="token string">"shengzhen"</span>
4<span class="token punctuation">)</span> <span class="token string">"hangzhou"</span>
127.0.0.1:6379<span class="token operator">></span> GEORADIUS china:city 110 30 500 km
1<span class="token punctuation">)</span> <span class="token string">"chongqi"</span>
2<span class="token punctuation">)</span> <span class="token string">"xian"</span>
127.0.0.1:6379<span class="token operator">></span> GEORADIUS china:city 110 30 500 km withdist <span class="token comment" spellcheck="true"># 显示到中间距离的位置</span>
1<span class="token punctuation">)</span> 1<span class="token punctuation">)</span> <span class="token string">"chongqi"</span>
2<span class="token punctuation">)</span> <span class="token string">"341.9374"</span>
2<span class="token punctuation">)</span> 1<span class="token punctuation">)</span> <span class="token string">"xian"</span>
2<span class="token punctuation">)</span> <span class="token string">"483.8340"</span>
127.0.0.1:6379<span class="token operator">></span> GEORADIUS china:city 110 30 500 km withcoord <span class="token comment" spellcheck="true"># 显示他人的定位信息</span>
1<span class="token punctuation">)</span> 1<span class="token punctuation">)</span> <span class="token string">"chongqi"</span>
2<span class="token punctuation">)</span> 1<span class="token punctuation">)</span> <span class="token string">"106.49999767541885376"</span>
2<span class="token punctuation">)</span> <span class="token string">"29.52999957900659211"</span>
2<span class="token punctuation">)</span> 1<span class="token punctuation">)</span> <span class="token string">"xian"</span>
2<span class="token punctuation">)</span> 1<span class="token punctuation">)</span> <span class="token string">"108.96000176668167114"</span>
2<span class="token punctuation">)</span> <span class="token string">"34.25999964418929977"</span>
127.0.0.1:6379<span class="token operator">></span> GEORADIUS china:city 110 30 500 km withdist withcoord count 1 <span class="token comment" spellcheck="true">#</span>
筛选出指定的结果！
1<span class="token punctuation">)</span> 1<span class="token punctuation">)</span> <span class="token string">"chongqi"</span>
2<span class="token punctuation">)</span> <span class="token string">"341.9374"</span>
3<span class="token punctuation">)</span> 1<span class="token punctuation">)</span> <span class="token string">"106.49999767541885376"</span>
2<span class="token punctuation">)</span> <span class="token string">"29.52999957900659211"</span>
127.0.0.1:6379<span class="token operator">></span> GEORADIUS china:city 110 30 500 km withdist withcoord count 2
1<span class="token punctuation">)</span> 1<span class="token punctuation">)</span> <span class="token string">"chongqi"</span>
2<span class="token punctuation">)</span> <span class="token string">"341.9374"</span>
3<span class="token punctuation">)</span> 1<span class="token punctuation">)</span> <span class="token string">"106.49999767541885376"</span>
2<span class="token punctuation">)</span> <span class="token string">"29.52999957900659211"</span>
2<span class="token punctuation">)</span> 1<span class="token punctuation">)</span> <span class="token string">"xian"</span>
2<span class="token punctuation">)</span> <span class="token string">"483.8340"</span>
3<span class="token punctuation">)</span> 1<span class="token punctuation">)</span> <span class="token string">"108.96000176668167114"</span>
2<span class="token punctuation">)</span> <span class="token string">"34.25999964418929977"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p>GEORADIUSBYMEMBER</p>
</blockquote>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># 找出位于指定元素周围的其他元素！</span>
127.0.0.1:6379<span class="token operator">></span> GEORADIUSBYMEMBER china:city beijing 1000 km
1<span class="token punctuation">)</span> <span class="token string">"beijing"</span>
2<span class="token punctuation">)</span> <span class="token string">"xian"</span>
127.0.0.1:6379<span class="token operator">></span> GEORADIUSBYMEMBER china:city shanghai 400 km
1<span class="token punctuation">)</span> <span class="token string">"hangzhou"</span>
2<span class="token punctuation">)</span> <span class="token string">"shanghai"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p>GEOHASH 命令 - 返回一个或多个位置元素的 Geohash 表示</p>
</blockquote>
<p>该命令将返回11个字符的Geohash字符串!</p>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># 将二维的经纬度转换为一维的字符串，如果两个字符串越接近，那么则距离越近！</span>
127.0.0.1:6379<span class="token operator">></span> geohash china:city beijing chongqi
1<span class="token punctuation">)</span> <span class="token string">"wx4fbxxfke0"</span>
2<span class="token punctuation">)</span> <span class="token string">"wm5xzrybty0"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p>GEO 底层的实现原理其实就是 Zset！我们可以使用Zset命令来操作geo！</p>
</blockquote>
<pre class="line-numbers language-bash"><code class="language-bash">127.0.0.1:6379<span class="token operator">></span> ZRANGE china:city 0 -1 <span class="token comment" spellcheck="true"># 查看地图中全部的元素</span>
1<span class="token punctuation">)</span> <span class="token string">"chongqi"</span>
2<span class="token punctuation">)</span> <span class="token string">"xian"</span>
3<span class="token punctuation">)</span> <span class="token string">"shengzhen"</span>
4<span class="token punctuation">)</span> <span class="token string">"hangzhou"</span>
5<span class="token punctuation">)</span> <span class="token string">"shanghai"</span>
6<span class="token punctuation">)</span> <span class="token string">"beijing"</span>
127.0.0.1:6379<span class="token operator">></span> zrem china:city beijing <span class="token comment" spellcheck="true"># 移除指定元素！</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> 1
127.0.0.1:6379<span class="token operator">></span> ZRANGE china:city 0 -1
1<span class="token punctuation">)</span> <span class="token string">"chongqi"</span>
2<span class="token punctuation">)</span> <span class="token string">"xian"</span>
3<span class="token punctuation">)</span> <span class="token string">"shengzhen"</span>
4<span class="token punctuation">)</span> <span class="token string">"hangzhou"</span>
5<span class="token punctuation">)</span> <span class="token string">"shanghai"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="Hyperloglog"><a href="#Hyperloglog" class="headerlink" title="Hyperloglog"></a>Hyperloglog</h2><blockquote>
<p>什么是基数？</p>
</blockquote>
<p>A {1,3,5,7,8,7} </p>
<p>B{1,3,5,7,8}</p>
<p>基数（不重复的元素） = 5，可以接受误差！</p>
<blockquote>
<p>简介</p>
</blockquote>
<p>Redis 2.8.9 版本就更新了 Hyperloglog 数据结构！ </p>
<p>Redis Hyperloglog 基数统计的算法！</p>
<p>优点：占用的内存是固定，2^64 不同的元素的技术，只需要废 12KB内存！如果要从内存角度来比较的 话 Hyperloglog 首选！</p>
<p>网页的 UV （即页面浏览量，一个人访问一个网站多次，但是还是算作一个人！） </p>
<p>传统的方式， set 保存用户的id，然后就可以统计 set 中的元素数量作为标准判断 ! 这个方式如果保存大量的用户id，就会比较麻烦！我们的目的是为了计数，而不是保存用户id； 0.81% 错误率！ 统计UV任务，可以忽略不计的！</p>
<blockquote>
<p>测试使用</p>
</blockquote>
<pre class="line-numbers language-bash"><code class="language-bash">127.0.0.1:6379<span class="token operator">></span> PFadd mykey a b c d e f g h i j <span class="token comment" spellcheck="true"># 创建第一组元素 mykey </span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> 1
127.0.0.1:6379<span class="token operator">></span> PFCOUNT mykey <span class="token comment" spellcheck="true"># 统计 mykey 元素的基数数量</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> 10
127.0.0.1:6379<span class="token operator">></span> PFadd mykey2 i j z x c <span class="token function">v</span> b n m <span class="token comment" spellcheck="true"># 创建第二组元素 mykey2</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> 1
127.0.0.1:6379<span class="token operator">></span> PFCOUNT mykey2
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> 9
127.0.0.1:6379<span class="token operator">></span> PFMERGE mykey3 mykey mykey2 <span class="token comment" spellcheck="true"># 合并两组 mykey mykey2 => mykey3 并集</span>
OK
127.0.0.1:6379<span class="token operator">></span> PFCOUNT mykey3 <span class="token comment" spellcheck="true"># 看并集的数量！</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> 15<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>如果允许容错，那么一定可以使用 Hyperloglog ！</p>
<p>如果不允许容错，就使用 set 或者自己的数据类型即可</p>
<p>每个用户登录进来就可以用PFadd放进来，它不会重复统计。</p>
<h2 id="Bitmap"><a href="#Bitmap" class="headerlink" title="Bitmap"></a>Bitmap</h2><p>为什么其他教程都不喜欢讲这些？这些在生活中或者开发中，都有十分多的应用场景，学习了，就是多一个思路！</p>
<blockquote>
<p>位存储</p>
</blockquote>
<p>统计用户信息，活跃，不活跃！ 登录 、 未登录！ 打卡，365打卡！ 两个状态的，都可以使用 Bitmaps！</p>
<p>Bitmap 位图，数据结构！ 都是操作二进制位来进行记录，就只有0 和 1 两个状态！ 365 天 = 365 bit 1字节 = 8bit 46 个字节左右！</p>
<blockquote>
<p>测试</p>
</blockquote>
<p><img src="/2020/07/28/redis/image-20200606015050461.png"></p>
<p>使用bitmap 来记录周一到周日的打卡！周一：1   周二：0  周三：0  周四：1 ……</p>
<p><img src="/2020/07/28/redis/image-20200606015128877.png"></p>
<p>查看某一天是否有打卡！</p>
<pre class="line-numbers language-bash"><code class="language-bash">127.0.0.1:6379<span class="token operator">></span> getbit sign 3
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> 1
127.0.0.1:6379<span class="token operator">></span> getbit sign 6
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> 0<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>统计操作，统计打卡的天数！</p>
<pre><code>127.0.0.1:6379&gt; bitcount sign  # 统计这周的打卡记录，就可以看到是否有全勤！
(integer) 3</code></pre>
<h1 id="事务"><a href="#事务" class="headerlink" title="事务"></a>事务</h1><p>Redis 事务本质：一组命令的集合！ 一个事务中的所有命令都会被序列化，在事务执行过程的中，会按</p>
<p>照顺序执行！</p>
<p>一次性、顺序性、排他性！执行一些列的命令！</p>
<pre><code>------ 队列 set set set 执行------</code></pre>
<p>Redis事务没有隔离级别的概念！</p>
<p>所有的命令在事务中，并没有直接被执行！只有发起执行命令的时候才会执行！Exec</p>
<p>Redis单条命令式保存原子性的，但是事务不保证原子性！</p>
<p>redis的事务：</p>
<ul>
<li>开启事务（multi）</li>
<li>命令入队（……）</li>
<li>执行事务（exec）</li>
</ul>
<blockquote>
<p>正常执行事务！</p>
</blockquote>
<pre class="line-numbers language-bash"><code class="language-bash">127.0.0.1:6379<span class="token operator">></span> multi <span class="token comment" spellcheck="true"># 开启事务</span>
OK
<span class="token comment" spellcheck="true"># 命令入队</span>
127.0.0.1:6379<span class="token operator">></span> <span class="token keyword">set</span> k1 v1
QUEUED
127.0.0.1:6379<span class="token operator">></span> <span class="token keyword">set</span> k2 v2
QUEUED
127.0.0.1:6379<span class="token operator">></span> get k2
QUEUED
127.0.0.1:6379<span class="token operator">></span> <span class="token keyword">set</span> k3 v3
QUEUED
127.0.0.1:6379<span class="token operator">></span> <span class="token function">exec</span> <span class="token comment" spellcheck="true"># 执行事务</span>
1<span class="token punctuation">)</span> OK
2<span class="token punctuation">)</span> OK
3<span class="token punctuation">)</span> <span class="token string">"v2"</span>
4<span class="token punctuation">)</span> OK<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>tips：当命令执行完，事务就结束了。每次想使用事务都要重新开启事务。</p>
<blockquote>
<p>放弃事务！</p>
</blockquote>
<pre class="line-numbers language-bash"><code class="language-bash">127.0.0.1:6379<span class="token operator">></span> multi <span class="token comment" spellcheck="true"># 开启事务</span>
OK
127.0.0.1:6379<span class="token operator">></span> <span class="token keyword">set</span> k1 v1
QUEUED
127.0.0.1:6379<span class="token operator">></span> <span class="token keyword">set</span> k2 v2
QUEUED
127.0.0.1:6379<span class="token operator">></span> <span class="token keyword">set</span> k4 v4
QUEUED
127.0.0.1:6379<span class="token operator">></span> DISCARD <span class="token comment" spellcheck="true"># 取消事务</span>
OK
127.0.0.1:6379<span class="token operator">></span> get k4 <span class="token comment" spellcheck="true"># 事务队列中命令都不会被执行！</span>
<span class="token punctuation">(</span>nil<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p>编译型异常（代码有问题！ 命令有错！） ，事务中所有的命令都不会被执行！</p>
</blockquote>
<pre class="line-numbers language-bash"><code class="language-bash">127.0.0.1:6379<span class="token operator">></span> multi
OK
127.0.0.1:6379<span class="token operator">></span> <span class="token keyword">set</span> k1 v1
QUEUED
127.0.0.1:6379<span class="token operator">></span> <span class="token keyword">set</span> k2 v2
QUEUED
127.0.0.1:6379<span class="token operator">></span> <span class="token keyword">set</span> k3 v3
QUEUED
127.0.0.1:6379<span class="token operator">></span> getset k3 <span class="token comment" spellcheck="true"># 错误的命令</span>
<span class="token punctuation">(</span>error<span class="token punctuation">)</span> ERR wrong number of arguments <span class="token keyword">for</span> <span class="token string">'getset'</span> <span class="token function">command</span>
127.0.0.1:6379<span class="token operator">></span> <span class="token keyword">set</span> k4 v4
QUEUED
127.0.0.1:6379<span class="token operator">></span> <span class="token keyword">set</span> k5 v5
QUEUED
127.0.0.1:6379<span class="token operator">></span> <span class="token function">exec</span> <span class="token comment" spellcheck="true"># 执行事务报错！</span>
<span class="token punctuation">(</span>error<span class="token punctuation">)</span> EXECABORT Transaction discarded because of previous errors.
127.0.0.1:6379<span class="token operator">></span> get k5 <span class="token comment" spellcheck="true"># 所有的命令都不会被执行！</span>
<span class="token punctuation">(</span>nil<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p>运行时异常（1/0）， 如果事务队列中存在语法性，那么执行命令的时候，其他命令是可以正常执行 的，错误命令抛出异常！</p>
</blockquote>
<pre class="line-numbers language-bash"><code class="language-bash">127.0.0.1:6379<span class="token operator">></span> <span class="token keyword">set</span> k1 <span class="token string">"v1"</span>
OK
127.0.0.1:6379<span class="token operator">></span> multi
OK
127.0.0.1:6379<span class="token operator">></span> incr k1 <span class="token comment" spellcheck="true"># 会执行的时候失败！</span>
QUEUED
127.0.0.1:6379<span class="token operator">></span> <span class="token keyword">set</span> k2 v2
QUEUED
127.0.0.1:6379<span class="token operator">></span> <span class="token keyword">set</span> k3 v3
QUEUED
127.0.0.1:6379<span class="token operator">></span> get k3
QUEUED
127.0.0.1:6379<span class="token operator">></span> <span class="token function">exec</span>
1<span class="token punctuation">)</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> ERR value is not an integer or out of range <span class="token comment" spellcheck="true"># 虽然第一条命令报错了，但是依旧正常执行成功了！</span>
2<span class="token punctuation">)</span> OK
3<span class="token punctuation">)</span> OK
4<span class="token punctuation">)</span> <span class="token string">"v3"</span>
127.0.0.1:6379<span class="token operator">></span> get k2
<span class="token string">"v2"</span>
127.0.0.1:6379<span class="token operator">></span> get k3
<span class="token string">"v3"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p>监控！ Watch （面试常问！）</p>
</blockquote>
<p><strong>悲观锁：</strong></p>
<p>很悲观，认为什么时候都会出问题，无论做什么都会加锁！</p>
<p><strong>乐观锁：</strong></p>
<ul>
<li>很乐观，认为什么时候都不会出问题，所以不会上锁！ 更新数据的时候去判断一下，在此期间是否有人修改过这个数据，</li>
<li>获取version</li>
<li>更新的时候比较 version</li>
</ul>
<blockquote>
<p>Redis测监视测试 </p>
</blockquote>
<p>正常执行成功！</p>
<pre class="line-numbers language-bash"><code class="language-bash">127.0.0.1:6379<span class="token operator">></span> <span class="token keyword">set</span> money 100
OK
127.0.0.1:6379<span class="token operator">></span> <span class="token keyword">set</span> out 0
OK
127.0.0.1:6379<span class="token operator">></span> <span class="token function">watch</span> money <span class="token comment" spellcheck="true"># 监视 money 对象</span>
OK
127.0.0.1:6379<span class="token operator">></span> multi <span class="token comment" spellcheck="true"># 事务正常结束，数据期间没有发生变动，这个时候就正常执行成功！</span>
OK
127.0.0.1:6379<span class="token operator">></span> DECRBY money 20
QUEUED
127.0.0.1:6379<span class="token operator">></span> INCRBY out 20
QUEUED
127.0.0.1:6379<span class="token operator">></span> <span class="token function">exec</span>
1<span class="token punctuation">)</span> <span class="token punctuation">(</span>integer<span class="token punctuation">)</span> 80
2<span class="token punctuation">)</span> <span class="token punctuation">(</span>integer<span class="token punctuation">)</span> 20<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>测试多线程修改值 , 使用watch 可以当做redis的乐观锁操作！</p>
<pre class="line-numbers language-bash"><code class="language-bash">127.0.0.1:6379<span class="token operator">></span> <span class="token function">watch</span> money <span class="token comment" spellcheck="true"># 监视 money</span>
OK
127.0.0.1:6379<span class="token operator">></span> multi
OK
127.0.0.1:6379<span class="token operator">></span> DECRBY money 10
QUEUED
127.0.0.1:6379<span class="token operator">></span> INCRBY out 10
QUEUED
127.0.0.1:6379<span class="token operator">></span> <span class="token function">exec</span> <span class="token comment" spellcheck="true"># 执行之前，另外一个线程，修改了我们的值，这个时候，就会导致事务执行失败！</span>
<span class="token punctuation">(</span>nil<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>如果修改失败，获取最新的值就好</p>
<p>有图</p>
<h1 id="Jedis"><a href="#Jedis" class="headerlink" title="Jedis"></a>Jedis</h1><p>我们要使用 Java 来操作 Redis，知其然并知其所以然，授人以渔！ 学习不能急躁，慢慢来会很快！</p>
<blockquote>
<p>什么是Jedis?是Redis 官方推荐的 java连接开发工具！ 使用Java 操作Redis 中间件！如果你要使用 java操作redis，那么一定要对Jedis 十分的熟悉！</p>
</blockquote>
<blockquote>
<p>测试</p>
</blockquote>
<p>1、导入对应的依赖</p>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token operator">&lt;</span><span class="token operator">!</span>--导入jedis的包--<span class="token operator">></span>
<span class="token operator">&lt;</span>dependencies<span class="token operator">></span>
<span class="token operator">&lt;</span><span class="token operator">!</span>-- https://mvnrepository.com/artifact/redis.clients/jedis --<span class="token operator">></span>
<span class="token operator">&lt;</span>dependency<span class="token operator">></span>
<span class="token operator">&lt;</span>groupId<span class="token operator">></span>redis.clients<span class="token operator">&lt;</span>/groupId<span class="token operator">></span>
<span class="token operator">&lt;</span>artifactId<span class="token operator">></span>jedis<span class="token operator">&lt;</span>/artifactId<span class="token operator">></span>
<span class="token operator">&lt;</span>version<span class="token operator">></span>3.2.0<span class="token operator">&lt;</span>/version<span class="token operator">></span>
<span class="token operator">&lt;</span>/dependency<span class="token operator">></span>
<span class="token operator">&lt;</span><span class="token operator">!</span>--fastjson--<span class="token operator">></span>
<span class="token operator">&lt;</span>dependency<span class="token operator">></span>
<span class="token operator">&lt;</span>groupId<span class="token operator">></span>com.alibaba<span class="token operator">&lt;</span>/groupId<span class="token operator">></span>
<span class="token operator">&lt;</span>artifactId<span class="token operator">></span>fastjson<span class="token operator">&lt;</span>/artifactId<span class="token operator">></span>
<span class="token operator">&lt;</span>version<span class="token operator">></span>1.2.62<span class="token operator">&lt;</span>/version<span class="token operator">></span>
<span class="token operator">&lt;</span>/dependency<span class="token operator">></span>
<span class="token operator">&lt;</span>/dependencies<span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>Redis是Key-Value型内存数据库,不能直接存储对象，可以存json字符串。所以需要使用json进行中转</p>
<p>2、编码测试： 连接数据库 操作命令 断开连接！</p>
<pre class="line-numbers language-java"><code class="language-java"><span class="token keyword">package</span> com<span class="token punctuation">.</span>kuang<span class="token punctuation">;</span>
<span class="token keyword">import</span> redis<span class="token punctuation">.</span>clients<span class="token punctuation">.</span>jedis<span class="token punctuation">.</span>Jedis<span class="token punctuation">;</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TestPing</span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">// 1、 new Jedis 对象即可</span>
Jedis jedis <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Jedis</span><span class="token punctuation">(</span><span class="token string">"127.0.0.1"</span><span class="token punctuation">,</span><span class="token number">6379</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">// jedis 所有的命令就是我们之前学习的所有指令！所以之前的指令学习很重要！</span>
System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>jedis<span class="token punctuation">.</span><span class="token function">ping</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>
<span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>输出：pong</p>
<h2 id="常用的API"><a href="#常用的API" class="headerlink" title="常用的API"></a>常用的API</h2><p>String</p>
<p>List</p>
<p>Set</p>
<p>Hash</p>
<p>Zset</p>
<blockquote>
<p>所有的api命令，就是我们对应的上面学习的指令，一个都没有变化！</p>
</blockquote>
<blockquote>
<p>事务</p>
</blockquote>
<pre class="line-numbers language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TestTX</span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
Jedis jedis <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Jedis</span><span class="token punctuation">(</span><span class="token string">"127.0.0.1"</span><span class="token punctuation">,</span> <span class="token number">6379</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
jedis<span class="token punctuation">.</span><span class="token function">flushDB</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
JSONObject jsonObject <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">JSONObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
jsonObject<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"hello"</span><span class="token punctuation">,</span><span class="token string">"world"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
jsonObject<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">,</span><span class="token string">"kuangshen"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">// 开启事务</span>
Transaction multi <span class="token operator">=</span> jedis<span class="token punctuation">.</span><span class="token function">multi</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
String result <span class="token operator">=</span> jsonObject<span class="token punctuation">.</span><span class="token function">toJSONString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">// jedis.watch(result)</span>
<span class="token keyword">try</span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
multi<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">"user1"</span><span class="token punctuation">,</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
multi<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">"user2"</span><span class="token punctuation">,</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token operator">/</span><span class="token number">0</span> <span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// 代码抛出异常事务，执行失败！</span>
multi<span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// 执行事务！</span>
<span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
multi<span class="token punctuation">.</span><span class="token function">discard</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// 放弃事务</span>
e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span> <span class="token keyword">finally</span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>jedis<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"user1"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>jedis<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"user2"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
jedis<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// 关闭连接</span>
<span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>
<span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>
<span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h1 id="SpringBoot整合"><a href="#SpringBoot整合" class="headerlink" title="SpringBoot整合"></a>SpringBoot整合</h1><p>SpringBoot 操作数据：spring-data jpa jdbc mongodb redis！</p>
<p>SpringData 也是和 SpringBoot 齐名的项目！</p>
<p>说明： 在 SpringBoot2.x 之后，原来使用的jedis 被替换为了 lettuce?</p>
<p>jedis : 采用的直连，多个线程操作的话，是不安全的，如果想要避免不安全的，使用 jedis pool 连接</p>
<p>池！ 更像 BIO 模式</p>
<p>lettuce : 采用netty，实例可以再多个线程中进行共享，不存在线程不安全的情况！可以减少线程数据</p>
<p>了，更像 NIO 模式</p>
<p>源码分析：</p>
<pre class="line-numbers language-java"><code class="language-java"><span class="token annotation punctuation">@Bean</span>
<span class="token annotation punctuation">@ConditionalOnMissingBean</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">"redisTemplate"</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// 我们可以自己定义一个</span>
redisTemplate来替换这个默认的！
<span class="token keyword">public</span> RedisTemplate<span class="token operator">&lt;</span>Object<span class="token punctuation">,</span> Object<span class="token operator">></span> <span class="token function">redisTemplate</span><span class="token punctuation">(</span>RedisConnectionFactory
redisConnectionFactory<span class="token punctuation">)</span>
<span class="token keyword">throws</span> UnknownHostException <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">// 默认的 RedisTemplate 没有过多的设置，redis 对象都是需要序列化！</span>
<span class="token comment" spellcheck="true">// 两个泛型都是 Object, Object 的类型，我们后使用需要强制转换 &lt;String, Object></span>
RedisTemplate<span class="token operator">&lt;</span>Object<span class="token punctuation">,</span> Object<span class="token operator">></span> template <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RedisTemplate</span><span class="token operator">&lt;</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
template<span class="token punctuation">.</span><span class="token function">setConnectionFactory</span><span class="token punctuation">(</span>redisConnectionFactory<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">return</span> template<span class="token punctuation">;</span>
<span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>
<span class="token annotation punctuation">@Bean</span>
<span class="token annotation punctuation">@ConditionalOnMissingBean</span> <span class="token comment" spellcheck="true">// 由于 String 是redis中最常使用的类型，所以说单独提出来了一</span>
个bean！
<span class="token keyword">public</span> StringRedisTemplate <span class="token function">stringRedisTemplate</span><span class="token punctuation">(</span>RedisConnectionFactory
redisConnectionFactory<span class="token punctuation">)</span>
<span class="token keyword">throws</span> UnknownHostException <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
StringRedisTemplate template <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StringRedisTemplate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
template<span class="token punctuation">.</span><span class="token function">setConnectionFactory</span><span class="token punctuation">(</span>redisConnectionFactory<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">return</span> template<span class="token punctuation">;</span>
<span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p>整合测试一下</p>
</blockquote>
<p>1、导入依赖</p>
<pre class="line-numbers language-xml"><code class="language-xml"><span class="token comment" spellcheck="true">&lt;!-- 操作redis --></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-boot-starter-data-redis<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>2、配置连接</p>
<pre><code># 配置redis
spring.redis.host=127.0.0.1
spring.redis.port=6379</code></pre>
<p>3、测试！</p>
<pre class="line-numbers language-java"><code class="language-java"><span class="token annotation punctuation">@SpringBootTest</span>
<span class="token keyword">class</span> <span class="token class-name">Redis02SpringbootApplicationTests</span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
<span class="token annotation punctuation">@Autowired</span>
<span class="token keyword">private</span> RedisTemplate redisTemplate<span class="token punctuation">;</span>
<span class="token annotation punctuation">@Test</span>
<span class="token keyword">void</span> <span class="token function">contextLoads</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">// redisTemplate 操作不同的数据类型，api和我们的指令是一样的</span>
<span class="token comment" spellcheck="true">// opsForValue 操作字符串 类似String</span>
<span class="token comment" spellcheck="true">// opsForList 操作List 类似List</span>
<span class="token comment" spellcheck="true">// opsForSet</span>
<span class="token comment" spellcheck="true">// opsForHash</span>
<span class="token comment" spellcheck="true">// opsForZSet</span>
<span class="token comment" spellcheck="true">// opsForGeo</span>
<span class="token comment" spellcheck="true">// opsForHyperLogLog</span>
<span class="token comment" spellcheck="true">// 除了进本的操作，我们常用的方法都可以直接通过redisTemplate操作，比如事务，和基本的</span>
CRUD
<span class="token comment" spellcheck="true">// 获取redis的连接对象</span>
<span class="token comment" spellcheck="true">// RedisConnection connection =</span>
redisTemplate<span class="token punctuation">.</span><span class="token function">getConnectionFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">// connection.flushDb();</span>
<span class="token comment" spellcheck="true">// connection.flushAll();</span>
redisTemplate<span class="token punctuation">.</span><span class="token function">opsForValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">"mykey"</span><span class="token punctuation">,</span><span class="token string">"关注狂神说公众号"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>redisTemplate<span class="token punctuation">.</span><span class="token function">opsForValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"mykey"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>
<span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>关于对象的保存：</p>
<p>我们来编写一个自己的 RedisTemplete</p>
<pre class="line-numbers language-css"><code class="language-css">package com<span class="token number">.</span>kuang<span class="token number">.</span>config<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<pre class="line-numbers language-css"><code class="language-css">import com<span class="token number">.</span>fasterxml<span class="token number">.</span>jackson<span class="token number">.</span>annotation<span class="token number">.</span>JsonAutoDetect<span class="token punctuation">;</span>
import com<span class="token number">.</span>fasterxml<span class="token number">.</span>jackson<span class="token number">.</span>annotation<span class="token number">.</span>PropertyAccessor<span class="token punctuation">;</span>
import com<span class="token number">.</span>fasterxml<span class="token number">.</span>jackson<span class="token number">.</span>databind<span class="token number">.</span>ObjectMapper<span class="token punctuation">;</span>
import org<span class="token number">.</span>springframework<span class="token number">.</span>context<span class="token number">.</span>annotation<span class="token number">.</span>Bean<span class="token punctuation">;</span>
import org<span class="token number">.</span>springframework<span class="token number">.</span>context<span class="token number">.</span>annotation<span class="token number">.</span>Configuration<span class="token punctuation">;</span>
import org<span class="token number">.</span>springframework<span class="token number">.</span>data<span class="token number">.</span>redis<span class="token number">.</span>connection<span class="token number">.</span>RedisConnectionFactory<span class="token punctuation">;</span>
import org<span class="token number">.</span>springframework<span class="token number">.</span>data<span class="token number">.</span>redis<span class="token number">.</span>core<span class="token number">.</span>RedisTemplate<span class="token punctuation">;</span>
import org<span class="token number">.</span>springframework<span class="token number">.</span>data<span class="token number">.</span>redis<span class="token number">.</span>serializer<span class="token number">.</span>Jackson<span class="token number">2</span>JsonRedisSerializer<span class="token punctuation">;</span>
import org<span class="token number">.</span>springframework<span class="token number">.</span>data<span class="token number">.</span>redis<span class="token number">.</span>serializer<span class="token number">.</span>StringRedisSerializer<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-java"><code class="language-java"><span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RedisConfig</span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>所有的redis操作，其实对于java开发人员来说，十分的简单，更重要是要去理解redis的思想和每一种数<br> 据结构的用处和作用场景！</p>

            </div>
            <hr/>

            

    <div class="reprint" id="reprint-statement">
        
            <div class="reprint__author">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-user">
                        文章作者:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="/about" rel="external nofollow noreferrer">YuHong Sun</a>
                </span>
            </div>
            <div class="reprint__type">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-link">
                        文章链接:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="http://Yuki-Asuuna.github.io/2020/07/28/redis/">http://Yuki-Asuuna.github.io/2020/07/28/redis/</a>
                </span>
            </div>
            <div class="reprint__notice">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-copyright">
                        版权声明:
                    </i>
                </span>
                <span class="reprint-info">
                    本博客所有文章除特別声明外，均采用
                    <a href="https://creativecommons.org/licenses/by/4.0/deed.zh" rel="external nofollow noreferrer" target="_blank">CC BY 4.0</a>
                    许可协议。转载请注明来源
                    <a href="/about" target="_blank">YuHong Sun</a>
                    !
                </span>
            </div>
        
    </div>

    <script async defer>
      document.addEventListener("copy", function (e) {
        let toastHTML = '<span>复制成功，请遵循本文的转载规则</span><button class="btn-flat toast-action" onclick="navToReprintStatement()" style="font-size: smaller">查看</a>';
        M.toast({html: toastHTML})
      });

      function navToReprintStatement() {
        $("html, body").animate({scrollTop: $("#reprint-statement").offset().top - 80}, 800);
      }
    </script>



            <div class="tag_share" style="display: block;">
                <div class="post-meta__tag-list" style="display: inline-block;">
                    
                        <div class="article-tag">
                            
                                <a href="/tags/database/">
                                    <span class="chip bg-color">database</span>
                                </a>
                            
                                <a href="/tags/linux/">
                                    <span class="chip bg-color">linux</span>
                                </a>
                            
                                <a href="/tags/Redis/">
                                    <span class="chip bg-color">Redis</span>
                                </a>
                            
                        </div>
                    
                </div>
                <div class="post_share" style="zoom: 80%; width: fit-content; display: inline-block; float: right; margin: -0.15rem 0;">
                    <link rel="stylesheet" type="text/css" href="/libs/share/css/share.min.css">
<div id="article-share">

    
    <div class="social-share" data-sites="twitter,facebook,google,qq,qzone,wechat,weibo,douban,linkedin" data-wechat-qrcode-helper="<p>微信扫一扫即可分享！</p>"></div>
    <script src="/libs/share/js/social-share.min.js"></script>
    

    

</div>

                </div>
            </div>
            
        </div>
    </div>

    
        <link rel="stylesheet" href="/libs/gitalk/gitalk.css">
<link rel="stylesheet" href="/css/my-gitalk.css">

<div class="card gitalk-card" data-aos="fade-up">
    <div class="comment_headling" style="font-size: 20px; font-weight: 700; position: relative; padding-left: 20px; top: 15px; padding-bottom: 5px;">
        <i class="fas fa-comments fa-fw" aria-hidden="true"></i>
        <span>评论</span>
    </div>
    <div id="gitalk-container" class="card-content"></div>
</div>

<script src="/libs/gitalk/gitalk.min.js"></script>
<script>
    let gitalk = new Gitalk({
        clientID: '',
        clientSecret: '',
        repo: '',
        owner: '',
        admin: null,
        id: '2020-07-28T14-10-25',
        distractionFreeMode: false  // Facebook-like distraction free mode
    });

    gitalk.render('gitalk-container');
</script>

    

    

    

    

    

    

    

<article id="prenext-posts" class="prev-next articles">
    <div class="row article-row">
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge left-badge text-color">
                <i class="fas fa-chevron-left"></i>&nbsp;上一篇</div>
            <div class="card">
                <a href="/2020/07/29/rubbish-recycle/">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/7.jpg" class="responsive-img" alt="Python内存管理和垃圾回收机制">
                        
                        <span class="card-title">Python内存管理和垃圾回收机制</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            ​    本文转载自：https://pythonav.com/wiki/detail/6/88/
1.前言​    一直以来有很多毕业生跑来问我，Python的垃圾回收机制到底是什么回事？从网上找到一大堆的文档，看的也是一知半解，最终就学
                        
                    </div>
                    <div class="publish-info">
                        <span class="publish-date">
                            <i class="far fa-clock fa-fw icon-date"></i>2020-07-29
                        </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-user fa-fw"></i>
                            YuHong Sun
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/python/">
                        <span class="chip bg-color">python</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge right-badge text-color">
                下一篇&nbsp;<i class="fas fa-chevron-right"></i>
            </div>
            <div class="card">
                <a href="/2020/07/28/docker/">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/20.jpg" class="responsive-img" alt="Docker笔记">
                        
                        <span class="card-title">Docker笔记</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            一、Docker介绍1.下载Docker依的赖环境​    安装Docker，首先要将依赖的环境全部下载下来，就像Maven依赖JDK一样
yum -y install yum-utils device-mapper-persistent-
                        
                    </div>
                    <div class="publish-info">
                            <span class="publish-date">
                                <i class="far fa-clock fa-fw icon-date"></i>2020-07-28
                            </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-user fa-fw"></i>
                            YuHong Sun
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/docker/">
                        <span class="chip bg-color">docker</span>
                    </a>
                    
                    <a href="/tags/linux/">
                        <span class="chip bg-color">linux</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
    </div>
</article>

</div>



<!-- 代码块功能依赖 -->
<script type="text/javascript" src="/libs/codeBlock/codeBlockFuction.js"></script>

<!-- 代码语言 -->

<script type="text/javascript" src="/libs/codeBlock/codeLang.js"></script>


<!-- 代码块复制 -->

<script type="text/javascript" src="/libs/codeBlock/codeCopy.js"></script>


<!-- 代码块收缩 -->

<script type="text/javascript" src="/libs/codeBlock/codeShrink.js"></script>


<!-- 代码块折行 -->

<style type="text/css">
code[class*="language-"], pre[class*="language-"] { white-space: pre !important; }
</style>


    </div>
    <div id="toc-aside" class="expanded col l3 hide-on-med-and-down">
        <div class="toc-widget">
            <div class="toc-title"><i class="far fa-list-alt"></i>&nbsp;&nbsp;目录</div>
            <div id="toc-content"></div>
        </div>
    </div>
</div>

<!-- TOC 悬浮按钮. -->

<div id="floating-toc-btn" class="hide-on-med-and-down">
    <a class="btn-floating btn-large bg-color">
        <i class="fas fa-list-ul"></i>
    </a>
</div>


<script src="/libs/tocbot/tocbot.min.js"></script>
<script>
    $(function () {
        tocbot.init({
            tocSelector: '#toc-content',
            contentSelector: '#articleContent',
            headingsOffset: -($(window).height() * 0.4 - 45),
            collapseDepth: Number('0'),
            headingSelector: 'h2, h3, h4'
        });

        // modify the toc link href to support Chinese.
        let i = 0;
        let tocHeading = 'toc-heading-';
        $('#toc-content a').each(function () {
            $(this).attr('href', '#' + tocHeading + (++i));
        });

        // modify the heading title id to support Chinese.
        i = 0;
        $('#articleContent').children('h2, h3, h4').each(function () {
            $(this).attr('id', tocHeading + (++i));
        });

        // Set scroll toc fixed.
        let tocHeight = parseInt($(window).height() * 0.4 - 64);
        let $tocWidget = $('.toc-widget');
        $(window).scroll(function () {
            let scroll = $(window).scrollTop();
            /* add post toc fixed. */
            if (scroll > tocHeight) {
                $tocWidget.addClass('toc-fixed');
            } else {
                $tocWidget.removeClass('toc-fixed');
            }
        });

        
        /* 修复文章卡片 div 的宽度. */
        let fixPostCardWidth = function (srcId, targetId) {
            let srcDiv = $('#' + srcId);
            if (srcDiv.length === 0) {
                return;
            }

            let w = srcDiv.width();
            if (w >= 450) {
                w = w + 21;
            } else if (w >= 350 && w < 450) {
                w = w + 18;
            } else if (w >= 300 && w < 350) {
                w = w + 16;
            } else {
                w = w + 14;
            }
            $('#' + targetId).width(w);
        };

        // 切换TOC目录展开收缩的相关操作.
        const expandedClass = 'expanded';
        let $tocAside = $('#toc-aside');
        let $mainContent = $('#main-content');
        $('#floating-toc-btn .btn-floating').click(function () {
            if ($tocAside.hasClass(expandedClass)) {
                $tocAside.removeClass(expandedClass).hide();
                $mainContent.removeClass('l9');
            } else {
                $tocAside.addClass(expandedClass).show();
                $mainContent.addClass('l9');
            }
            fixPostCardWidth('artDetail', 'prenext-posts');
        });
        
    });
</script>

    

</main>




    <footer class="page-footer bg-color">
    
        <link rel="stylesheet" href="/libs/aplayer/APlayer.min.css">
<style>
    .aplayer .aplayer-lrc p {
        
        display: none;
        
        font-size: 12px;
        font-weight: 700;
        line-height: 16px !important;
    }

    .aplayer .aplayer-lrc p.aplayer-lrc-current {
        
        display: none;
        
        font-size: 15px;
        color: #42b983;
    }

    
    .aplayer.aplayer-fixed.aplayer-narrow .aplayer-body {
        left: -66px !important;
    }

    .aplayer.aplayer-fixed.aplayer-narrow .aplayer-body:hover {
        left: 0px !important;
    }

    
</style>
<div class="">
    
    <div class="row">
        <meting-js class="col l8 offset-l2 m10 offset-m1 s12"
                   server="netease"
                   type="playlist"
                   id="503838841"
                   fixed='true'
                   autoplay='false'
                   theme='#42b983'
                   loop='all'
                   order='random'
                   preload='auto'
                   volume='0.7'
                   list-folded='true'
        >
        </meting-js>
    </div>
</div>

<script src="/libs/aplayer/APlayer.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/meting@2/dist/Meting.min.js"></script>

    
    <div class="container row center-align" style="margin-bottom: 0px !important;">
        <div class="col s12 m8 l8 copy-right">
            Copyright&nbsp;&copy;
            <span id="year">2020# 年份</span>
            <a href="/about" target="_blank">YuHong Sun</a>
            |&nbsp;Powered by&nbsp;<a href="https://hexo.io/" target="_blank">Hexo</a>
            |&nbsp;Theme&nbsp;<a href="https://github.com/blinkfox/hexo-theme-matery" target="_blank">Matery</a>
            <br>
            
            &nbsp;<i class="fas fa-chart-area"></i>&nbsp;站点总字数:&nbsp;<span
                class="white-color">81.4k</span>&nbsp;字
            
            
            
            
            
            
            <span id="busuanzi_container_site_pv">
                |&nbsp;<i class="far fa-eye"></i>&nbsp;总访问量:&nbsp;<span id="busuanzi_value_site_pv"
                    class="white-color"></span>&nbsp;次
            </span>
            
            
            <span id="busuanzi_container_site_uv">
                |&nbsp;<i class="fas fa-users"></i>&nbsp;总访问人数:&nbsp;<span id="busuanzi_value_site_uv"
                    class="white-color"></span>&nbsp;人
            </span>
            
            <br>
            
            <br>
            
        </div>
        <div class="col s12 m4 l4 social-link social-statis">
    <a href="https://github.com/Yuki-Asuuna" class="tooltipped" target="_blank" data-tooltip="访问我的GitHub" data-position="top" data-delay="50">
        <i class="fab fa-github"></i>
    </a>



    <a href="mailto:10174503104@stu.ecnu.edu.cn" class="tooltipped" target="_blank" data-tooltip="邮件联系我" data-position="top" data-delay="50">
        <i class="fas fa-envelope-open"></i>
    </a>







    <a href="tencent://AddContact/?fromId=50&fromSubId=1&subcmd=all&uin=501263359" class="tooltipped" target="_blank" data-tooltip="QQ联系我: 501263359" data-position="top" data-delay="50">
        <i class="fab fa-qq"></i>
    </a>





    <a href="https://www.zhihu.com/people/xi-lian-chuan-lu-xia" class="tooltipped" target="_blank" data-tooltip="关注我的知乎: https://www.zhihu.com/people/xi-lian-chuan-lu-xia" data-position="top" data-delay="50">
        <i class="fab fa-zhihu1">知</i>
    </a>



</div>
    </div>
</footer>

<div class="progress-bar"></div>


    <!-- 搜索遮罩框 -->
<div id="searchModal" class="modal">
    <div class="modal-content">
        <div class="search-header">
            <span class="title"><i class="fas fa-search"></i>&nbsp;&nbsp;搜索</span>
            <input type="search" id="searchInput" name="s" placeholder="请输入搜索的关键字"
                   class="search-input">
        </div>
        <div id="searchResult"></div>
    </div>
</div>

<script src="/js/search.js"></script>
<script type="text/javascript">
$(function () {
    searchFunc("/search.xml", 'searchInput', 'searchResult');
});
</script>

    <!-- 回到顶部按钮 -->
<div id="backTop" class="top-scroll">
    <a class="btn-floating btn-large waves-effect waves-light" href="#!">
        <i class="fas fa-arrow-up"></i>
    </a>
</div>


    <script src="/libs/materialize/materialize.min.js"></script>
    <script src="/libs/masonry/masonry.pkgd.min.js"></script>
    <script src="/libs/aos/aos.js"></script>
    <script src="/libs/scrollprogress/scrollProgress.min.js"></script>
    <script src="/libs/lightGallery/js/lightgallery-all.min.js"></script>
    <script src="/js/matery.js"></script>

    <!-- Baidu Analytics -->

    <!-- Baidu Push -->

<script>
    (function () {
        var bp = document.createElement('script');
        var curProtocol = window.location.protocol.split(':')[0];
        if (curProtocol === 'https') {
            bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
        } else {
            bp.src = 'http://push.zhanzhang.baidu.com/push.js';
        }
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(bp, s);
    })();
</script>

    
    
    <script async src="/libs/others/busuanzi.pure.mini.js"></script>
    

    

    

    

    

    

    
    <script src="/libs/instantpage/instantpage.js" type="module"></script>
    

<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"log":false,"model":{"jsonPath":"/live2dw/assets/koharu.model.json"},"display":{"position":"right","width":150,"height":300},"mobile":{"show":false},"react":{"opacity":0.7}});</script></body>

</html>
